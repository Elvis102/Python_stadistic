
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3. Comparing several means &#8212; Learning Statistics with Python</title>
    
  <link rel="stylesheet" href="_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.e7340bb3dbd8dde6db86f25597f54a1b.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.7d483ff0a819d6edff12ce0b1ead3928.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="5. Linear regression" href="05.04-regression.html" />
    <link rel="prev" title="2. Comparing Two Means" href="05.02-ttest.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  
  <h1 class="site-logo" id="site-title">Learning Statistics with Python</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="landingpage.html">
   Learning Statistics with Python
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Part I. Background
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="01.01-intro.html">
   1. Why do we learn statistics?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="01.02-studydesign.html">
   2. A brief introduction to research design
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Part II. An Introduction to Python
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="02.01-getting_started_with_python.html">
   1. Getting Started with Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02.01-getting_started_with_python.html#typing-commands-at-the-python-console">
   2. Typing commands at the Python console
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02.02-more_python_concepts.html">
   3. More Python Concepts
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Part III. Working With Data
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="03.01-descriptives.html">
   1. Descriptive statistics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03.02-drawing_graphs.html">
   2. Drawing Graphs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03.03-pragmatic_matters.html">
   3. Data Wrangling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03.04-basic_programming.html">
   4. Basic Programming
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Part IV. Statistical Theory
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="04.01-intro-to-probability.html">
   1. Statistical theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04.02-probability.html">
   2. Introduction to Probability
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04.03-estimation.html">
   3. Estimating unknown quantities from a sample
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04.04-hypothesis-testing.html">
   4. Hypothesis Testing
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Part V. Statistical Tools
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="05.01-chisquare.html">
   1. Categorical data analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05.02-ttest.html">
   2. Comparing Two Means
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   3. Comparing several means
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#comparing-several-means-one-way-anova">
   4. Comparing several means (one-way ANOVA)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05.04-regression.html">
   5. Linear regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05.05-anova2.html">
   6. Factorial ANOVA
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Part VI. Endings, Alternatives and Prospects
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="06.01-bayes.html">
   1. Bayesian Statistics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06.02-epilogue.html">
   2. Epilogue
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bibliography.html">
   3. References
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/05.03-anova.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/ethanweed/pythonbook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/ethanweed/pythonbook/issues/new?title=Issue%20on%20page%20%2F05.03-anova.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


            <!-- Full screen (wrap in <a> to have style consistency -->
            <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                    data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                    title="Fullscreen mode"><i
                        class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/ethanweed/pythonbook/https://github.com/ethanweed/pythonbook/tree/main/Chapters?urlpath=tree/05.03-anova.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i>
            Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   3. Comparing several means
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#comparing-several-means-one-way-anova">
   4. Comparing several means (one-way ANOVA)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#an-illustrative-data-set">
     4.1. An illustrative data set
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#how-anova-works">
     4.2. How ANOVA works
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#two-formulas-for-the-variance-of-y">
       4.2.1. Two formulas for the variance of
       <span class="math notranslate nohighlight">
        \(Y\)
       </span>
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#from-variances-to-sums-of-squares">
       4.2.2. From variances to sums of squares
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#from-sums-of-squares-to-the-f-test">
       4.2.3. From sums of squares to the
       <span class="math notranslate nohighlight">
        \(F\)
       </span>
       -test
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#the-model-for-the-data-and-the-meaning-of-f-advanced">
       4.2.4. The model for the data and the meaning of
       <span class="math notranslate nohighlight">
        \(F\)
       </span>
       (advanced)
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#a-worked-example">
       4.2.5. A worked example
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#running-an-anova-in-python">
     4.3. Running an ANOVA in Python
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#using-the-aov-function-to-specify-your-anova">
       4.3.1. Using the
       <code class="docutils literal notranslate">
        <span class="pre">
         aov()
        </span>
       </code>
       function to specify your ANOVA
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#understanding-what-the-aov-function-produces-aovobjects">
       4.3.2. Understanding what the
       <code class="docutils literal notranslate">
        <span class="pre">
         aov()
        </span>
       </code>
       function produces{#aovobjects}
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#running-the-hypothesis-tests-for-the-anova">
       4.3.3. Running the hypothesis tests for the ANOVA
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#effect-size">
     4.4. Effect size
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#multiple-comparisons-and-post-hoc-tests">
     4.5. Multiple comparisons and post hoc tests
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#running-pairwise-t-tests">
       4.5.1. Running “pairwise”
       <span class="math notranslate nohighlight">
        \(t\)
       </span>
       -tests
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#corrections-for-multiple-testing">
       4.5.2. Corrections for multiple testing
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#bonferroni-corrections">
       4.5.3. Bonferroni corrections
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#holm-corrections">
       4.5.4. Holm corrections
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#writing-up-the-post-hoc-test">
       4.5.5. Writing up the post hoc test
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#assumptions-of-one-way-anova">
     4.6. Assumptions of one-way ANOVA
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#how-robust-is-anova">
       4.6.1. How robust is ANOVA?
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#checking-the-homogeneity-of-variance-assumption">
     4.7. Checking the homogeneity of variance assumption
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#running-the-levene-s-test-in-r">
       4.7.1. Running the Levene’s test in R
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#additional-comments">
       4.7.2. Additional comments
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#removing-the-homogeneity-of-variance-assumption">
     4.8. Removing the homogeneity of variance assumption
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#checking-the-normality-assumption">
     4.9. Checking the normality assumption
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#removing-the-normality-assumption">
     4.10. Removing the normality assumption
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#the-logic-behind-the-kruskal-wallis-test">
       4.10.1. The logic behind the Kruskal-Wallis test
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#additional-details">
       4.10.2. Additional details
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#how-to-run-the-kruskal-wallis-test-in-r">
       4.10.3. How to run the Kruskal-Wallis test in R
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#on-the-relationship-between-anova-and-the-student-t-test-anovaandt">
     4.11. On the relationship between ANOVA and the Student
     <span class="math notranslate nohighlight">
      \(t\)
     </span>
     test{#anovaandt}
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#summary">
     4.12. Summary
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="comparing-several-means">
<span id="anova"></span><h1><span class="section-number">3. </span>Comparing several means<a class="headerlink" href="#comparing-several-means" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="comparing-several-means-one-way-anova">
<h1><span class="section-number">4. </span>Comparing several means (one-way ANOVA)<a class="headerlink" href="#comparing-several-means-one-way-anova" title="Permalink to this headline">¶</a></h1>
<p>This chapter introduces one of the most widely used tools in statistics, known as “the analysis of variance”, which is usually referred to as ANOVA. The basic technique was developed by Sir Ronald Fisher in the early 20th century, and it is to him that we owe the rather unfortunate terminology. The term ANOVA is a little misleading, in two respects. Firstly, although the name of the technique refers to variances, ANOVA is concerned with investigating differences in means. Secondly, there are several different things out there that are all referred to as ANOVAs, some of which have only a very tenuous connection to one another. Later on in the book we’ll encounter a range of different ANOVA methods that apply in quite different situations, but for the purposes of this chapter we’ll only consider the simplest form of ANOVA, in which we have several different groups of observations, and we’re interested in finding out whether those groups differ in terms of some outcome variable of interest. This is the question that is addressed by a <strong><em>one-way ANOVA</em></strong>.</p>
<p>The structure of this chapter is as follows: In <a class="reference internal" href="#anxifree"><span class="std std-ref">An illustrative data set</span></a> I’ll introduce a fictitious data set that we’ll use as a running example throughout the chapter. After introducing the data, I’ll describe the mechanics of how a one-way ANOVA actually works (<a class="reference internal" href="#anovaintro"><span class="std std-ref">How ANOVA works</span></a>) and then focus on how you can run one in Python (<a class="reference internal" href="#introduceaov"><span class="std std-ref">Running an ANOVA in Python</span></a>). These two sections are the core of the chapter. The remainder of the chapter discusses a range of important topics that inevitably arise when running an ANOVA, namely how to calculate effect sizes (<a class="reference internal" href="#etasquared"><span class="std std-ref">Effect size</span></a>), post hoc tests and corrections for multiple comparisons (<a class="reference internal" href="#posthoc"><span class="std std-ref">Multiple comparisons and post hoc tests</span></a>) and the assumptions that ANOVA relies upon (<a class="reference internal" href="#anovaassumptions"><span class="std std-ref">Assumptions of one-way ANOVA</span></a>). We’ll also talk about how to check those assumptions and some of the things you can do if the assumptions are violated (<a class="reference internal" href="#levene"><span class="std std-ref">Checking the homogeneity of variance assumption</span></a> to <a class="reference internal" href="#kruskalwallis"><span class="std std-ref">Removing the normality assumption</span></a>). At the end of the chapter we’ll talk a little about the relationship between ANOVA and other statistical tools (<span class="xref myst"></span>).</p>
<div class="section" id="an-illustrative-data-set">
<span id="anxifree"></span><h2><span class="section-number">4.1. </span>An illustrative data set<a class="headerlink" href="#an-illustrative-data-set" title="Permalink to this headline">¶</a></h2>
<p>Suppose you’ve become involved in a clinical trial in which you are testing a new antidepressant drug called <em>Joyzepam</em>. In order to construct a fair test of the drug’s effectiveness, the study involves three separate drugs to be administered. One is a placebo, and the other is an existing antidepressant / anti-anxiety drug called <em>Anxifree</em>. A collection of 18 participants with moderate to severe depression are recruited for your initial testing. Because the drugs are sometimes administered in conjunction with psychological therapy, your study includes 9 people undergoing cognitive behavioural therapy (CBT) and 9 who are not. Participants are randomly assigned (doubly blinded, of course) a treatment, such that there are 3 CBT people and 3 no-therapy people assigned to each of the 3 drugs. A psychologist assesses the mood of each person after a 3 month run with each drug: and the overall <em>improvement</em> in each person’s mood is assessed on a scale ranging from <span class="math notranslate nohighlight">\(-5\)</span> to <span class="math notranslate nohighlight">\(+5\)</span>.</p>
<p>With that as the study design, let’s now look at what we’ve got in the data file:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/ethanweed/pythonbook/main/Data/clintrial.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>So we have a single data frame called <code class="docutils literal notranslate"><span class="pre">clin.trial</span></code>, containing three variables; <code class="docutils literal notranslate"><span class="pre">drug</span></code>, <code class="docutils literal notranslate"><span class="pre">therapy</span></code> and <code class="docutils literal notranslate"><span class="pre">mood.gain</span></code>. Next, let’s look at the data frame to get a sense of what the data actually look like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>drug</th>
      <th>therapy</th>
      <th>mood_gain</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>placebo</td>
      <td>no.therapy</td>
      <td>0.5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>placebo</td>
      <td>no.therapy</td>
      <td>0.3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>placebo</td>
      <td>no.therapy</td>
      <td>0.1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>anxifree</td>
      <td>no.therapy</td>
      <td>0.6</td>
    </tr>
    <tr>
      <th>4</th>
      <td>anxifree</td>
      <td>no.therapy</td>
      <td>0.4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>anxifree</td>
      <td>no.therapy</td>
      <td>0.2</td>
    </tr>
    <tr>
      <th>6</th>
      <td>joyzepam</td>
      <td>no.therapy</td>
      <td>1.4</td>
    </tr>
    <tr>
      <th>7</th>
      <td>joyzepam</td>
      <td>no.therapy</td>
      <td>1.7</td>
    </tr>
    <tr>
      <th>8</th>
      <td>joyzepam</td>
      <td>no.therapy</td>
      <td>1.3</td>
    </tr>
    <tr>
      <th>9</th>
      <td>placebo</td>
      <td>CBT</td>
      <td>0.6</td>
    </tr>
    <tr>
      <th>10</th>
      <td>placebo</td>
      <td>CBT</td>
      <td>0.9</td>
    </tr>
    <tr>
      <th>11</th>
      <td>placebo</td>
      <td>CBT</td>
      <td>0.3</td>
    </tr>
    <tr>
      <th>12</th>
      <td>anxifree</td>
      <td>CBT</td>
      <td>1.1</td>
    </tr>
    <tr>
      <th>13</th>
      <td>anxifree</td>
      <td>CBT</td>
      <td>0.8</td>
    </tr>
    <tr>
      <th>14</th>
      <td>anxifree</td>
      <td>CBT</td>
      <td>1.2</td>
    </tr>
    <tr>
      <th>15</th>
      <td>joyzepam</td>
      <td>CBT</td>
      <td>1.8</td>
    </tr>
    <tr>
      <th>16</th>
      <td>joyzepam</td>
      <td>CBT</td>
      <td>1.3</td>
    </tr>
    <tr>
      <th>17</th>
      <td>joyzepam</td>
      <td>CBT</td>
      <td>1.4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>For the purposes of this chapter, what we’re really interested in is the effect of <code class="docutils literal notranslate"><span class="pre">drug</span></code> on <code class="docutils literal notranslate"><span class="pre">mood_gain</span></code>. The first thing to do is calculate some descriptive statistics and draw some graphs. In <a class="reference internal" href="03.01-descriptives.html#descriptives"><span class="std std-ref">Descriptive statistics</span></a> and <a class="reference internal" href="03.03-pragmatic_matters.html#datawrangling"><span class="std std-ref">Data Wrangling</span></a> we discussed a variety of different functions that can be used for this purpose. For instance, we can use the <code class="docutils literal notranslate"><span class="pre">pd.crosstab()</span></code> function to see how many people we have in each group:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;drug&quot;</span><span class="p">],</span> <span class="n">columns</span> <span class="o">=</span> <span class="s2">&quot;count&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>col_0</th>
      <th>count</th>
    </tr>
    <tr>
      <th>drug</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>anxifree</th>
      <td>6</td>
    </tr>
    <tr>
      <th>joyzepam</th>
      <td>6</td>
    </tr>
    <tr>
      <th>placebo</th>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Similarly, we can use the <code class="docutils literal notranslate"><span class="pre">aggregate()</span></code> function to calculate means and standard deviations for the <code class="docutils literal notranslate"><span class="pre">mood.gain</span></code> variable broken down by which <code class="docutils literal notranslate"><span class="pre">drug</span></code> was administered:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;drug&#39;</span><span class="p">)[</span><span class="s1">&#39;mood_gain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>drug
anxifree    0.716667
joyzepam    1.483333
placebo     0.450000
Name: mood_gain, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Finally, we can use <code class="docutils literal notranslate"><span class="pre">pointplot()</span></code> from the <code class="docutils literal notranslate"><span class="pre">seaborn</span></code> package to produce a pretty picture.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">pointplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;drug&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;mood_gain&#39;</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/05.03-anova_11_0.png" src="_images/05.03-anova_11_0.png" />
</div>
</div>
<div class="figure align-default" id="fig-moodgain" style="width: 600px">
<p class="caption"><span class="caption-number">Fig. 4.7 </span><span class="caption-text">Average mood gain as a function of drug administered. Error bars depict 95% confidence intervals associated with each of the group means.</span><a class="headerlink" href="#fig-moodgain" title="Permalink to this image">¶</a></p>
</div>
<p>The results are shown in <a class="reference internal" href="#fig-moodgain"><span class="std std-numref">Fig. 4.7</span></a>, which plots the average mood gain for all three conditions; error bars show 95% confidence intervals. As the plot makes clear, there is a larger improvement in mood for participants in the Joyzepam group than for either the Anxifree group or the placebo group. The Anxifree group shows a larger mood gain than the control group, but the difference isn’t as large.</p>
<p>The question that we want to answer is: are these difference “real”, or are they just due to chance?</p>
</div>
<div class="section" id="how-anova-works">
<span id="anovaintro"></span><h2><span class="section-number">4.2. </span>How ANOVA works<a class="headerlink" href="#how-anova-works" title="Permalink to this headline">¶</a></h2>
<p>In order to answer the question posed by our clinical trial data, we’re going to run a one-way ANOVA. As usual, I’m going to start by showing you how to do it the hard way, building the statistical tool from the ground up and showing you how you could do it in Python if you didn’t have access to any of the cool built-in ANOVA functions. And, as always, I hope you’ll read it carefully, try to do it the long way once or twice to make sure you really understand how ANOVA works, and then – once you’ve grasped the concept – never <em>ever</em> do it this way again.</p>
<p>The experimental design that I described in the previous section strongly suggests that we’re interested in comparing the average mood change for the three different drugs. In that sense, we’re talking about an analysis similar to the <span class="math notranslate nohighlight">\(t\)</span>-test <a class="reference internal" href="05.02-ttest.html#ttest"><span class="std std-ref">Comparing Two Means</span></a>, but involving more than two groups. If we let <span class="math notranslate nohighlight">\(\mu_P\)</span> denote the population mean for the mood change induced by the placebo, and let <span class="math notranslate nohighlight">\(\mu_A\)</span> and <span class="math notranslate nohighlight">\(\mu_J\)</span> denote the corresponding means for our two drugs, Anxifree and Joyzepam, then the (somewhat pessimistic) null hypothesis that we want to test is that all three population means are identical: that is, <em>neither</em> of the two drugs is any more effective than a placebo. Mathematically, we write this null hypothesis like this:</p>
<div class="math notranslate nohighlight">
\[
\begin{array}{rcl}
H_0 &amp;:&amp; \mbox{it is true that } \mu_P = \mu_A = \mu_J
\end{array}
\]</div>
<p>As a consequence, our alternative hypothesis is that at least one of the three different treatments is different from the others. It’s a little trickier to write this mathematically, because (as we’ll discuss) there are quite a few different ways in which the null hypothesis can be false. So for now we’ll just write the alternative hypothesis like this:</p>
<div class="math notranslate nohighlight">
\[
\begin{array}{rcl}
H_1 &amp;:&amp; \mbox{it is *not* true that } \mu_P = \mu_A = \mu_J
\end{array}
\]</div>
<p>This null hypothesis is a lot trickier to test than any of the ones we’ve seen previously. How shall we do it? A sensible guess would be to “do an ANOVA”, since that’s the title of the chapter, but it’s not particularly clear why an “analysis of <em>variances</em>” will help us learn anything useful about the <em>means</em>. In fact, this is one of the biggest conceptual difficulties that people have when first encountering ANOVA. To see how this works, I find it most helpful to start by talking about variances. In fact, what I’m going to do is start by playing some mathematical games with the formula that describes the variance. That is, we’ll start out by playing around with variances, and it will turn out that this gives us a useful tool for investigating means.</p>
<div class="section" id="two-formulas-for-the-variance-of-y">
<h3><span class="section-number">4.2.1. </span>Two formulas for the variance of <span class="math notranslate nohighlight">\(Y\)</span><a class="headerlink" href="#two-formulas-for-the-variance-of-y" title="Permalink to this headline">¶</a></h3>
<p>Firstly, let’s start by introducing some notation. We’ll use <span class="math notranslate nohighlight">\(G\)</span> to refer to the total number of groups. For our data set, there are three drugs, so there are <span class="math notranslate nohighlight">\(G=3\)</span> groups. Next, we’ll use <span class="math notranslate nohighlight">\(N\)</span> to refer to the total sample size: there are a total of <span class="math notranslate nohighlight">\(N=18\)</span> people in our data set. Similarly, let’s use <span class="math notranslate nohighlight">\(N_k\)</span> to denote the number of people in the <span class="math notranslate nohighlight">\(k\)</span>-th group. In our fake clinical trial, the sample size is <span class="math notranslate nohighlight">\(N_k = 6\)</span> for all three groups.<a class="footnote-reference brackets" href="#note1" id="id1">1</a> Finally, we’ll use <span class="math notranslate nohighlight">\(Y\)</span> to denote the outcome variable: in our case, <span class="math notranslate nohighlight">\(Y\)</span> refers to mood change. Specifically, we’ll use <span class="math notranslate nohighlight">\(Y_{ik}\)</span> to refer to the mood change experienced by the <span class="math notranslate nohighlight">\(i\)</span>-th member of the <span class="math notranslate nohighlight">\(k\)</span>-th group. Similarly, we’ll use <span class="math notranslate nohighlight">\(\bar{Y}\)</span> to be the average mood change, taken across all 18 people in the experiment, and <span class="math notranslate nohighlight">\(\bar{Y}_k\)</span> to refer to the average mood change experienced by the 6 people in group <span class="math notranslate nohighlight">\(k\)</span>.</p>
<p>Excellent. Now that we’ve got our notation sorted out, we can start writing down formulas. To start with, let’s recall the formula for the variance that we used in <a class="reference internal" href="03.01-descriptives.html#var"><span class="std std-ref">Variance</span></a>, way back in those kinder days when we were just doing descriptive statistics. The sample variance of <span class="math notranslate nohighlight">\(Y\)</span> is defined as follows:</p>
<div class="math notranslate nohighlight">
\[
\mbox{Var}(Y) = \frac{1}{N} \sum_{k=1}^G \sum_{i=1}^{N_k} \left(Y_{ik} - \bar{Y} \right)^2
\]</div>
<p>This formula looks pretty much identical to the formula for the variance in <a class="reference internal" href="03.01-descriptives.html#var"><span class="std std-ref">Variance</span></a>. The only difference is that this time around I’ve got two summations here: I’m summing over groups (i.e., values for <span class="math notranslate nohighlight">\(k\)</span>) and over the people within the groups (i.e., values for <span class="math notranslate nohighlight">\(i\)</span>). This is purely a cosmetic detail: if I’d instead used the notation <span class="math notranslate nohighlight">\(Y_p\)</span> to refer to the value of the outcome variable for person <span class="math notranslate nohighlight">\(p\)</span> in the sample, then I’d only have a single summation. The only reason that we have a double summation here is that I’ve classified people into groups, and then assigned numbers to people within groups.</p>
<p>A concrete example might be useful here. Let’s consider this table, in which we have a total of <span class="math notranslate nohighlight">\(N=5\)</span> people sorted into <span class="math notranslate nohighlight">\(G=2\)</span> groups. Arbitrarily, let’s say that the “cool” people are group 1, and the “uncool” people are group 2, and it turns out that we have three cool people (<span class="math notranslate nohighlight">\(N_1 = 3\)</span>) and two uncool people (<span class="math notranslate nohighlight">\(N_2 = 2\)</span>).</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>name</p></th>
<th class="text-align:left head"><p>person (<span class="math notranslate nohighlight">\(p\)</span>)</p></th>
<th class="text-align:left head"><p>group</p></th>
<th class="text-align:left head"><p>group num (<span class="math notranslate nohighlight">\(k\)</span>)</p></th>
<th class="text-align:left head"><p>index in group (<span class="math notranslate nohighlight">\(i\)</span>)</p></th>
<th class="text-align:left head"><p>grumpiness (<span class="math notranslate nohighlight">\(Y_{ik}\)</span> or <span class="math notranslate nohighlight">\(Y_p\)</span>)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>Ann</p></td>
<td class="text-align:left"><p>1</p></td>
<td class="text-align:left"><p>cool</p></td>
<td class="text-align:left"><p>1</p></td>
<td class="text-align:left"><p>1</p></td>
<td class="text-align:left"><p>20</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Ben</p></td>
<td class="text-align:left"><p>2</p></td>
<td class="text-align:left"><p>cool</p></td>
<td class="text-align:left"><p>1</p></td>
<td class="text-align:left"><p>2</p></td>
<td class="text-align:left"><p>55</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Cat</p></td>
<td class="text-align:left"><p>3</p></td>
<td class="text-align:left"><p>cool</p></td>
<td class="text-align:left"><p>1</p></td>
<td class="text-align:left"><p>3</p></td>
<td class="text-align:left"><p>21</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>Dan</p></td>
<td class="text-align:left"><p>4</p></td>
<td class="text-align:left"><p>uncool</p></td>
<td class="text-align:left"><p>2</p></td>
<td class="text-align:left"><p>1</p></td>
<td class="text-align:left"><p>91</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>Egg</p></td>
<td class="text-align:left"><p>5</p></td>
<td class="text-align:left"><p>uncool</p></td>
<td class="text-align:left"><p>2</p></td>
<td class="text-align:left"><p>2</p></td>
<td class="text-align:left"><p>22</p></td>
</tr>
</tbody>
</table>
<p>Notice that I’ve constructed two different labelling schemes here. We have a “person” variable <span class="math notranslate nohighlight">\(p\)</span>, so it would be perfectly sensible to refer to <span class="math notranslate nohighlight">\(Y_p\)</span> as the grumpiness of the <span class="math notranslate nohighlight">\(p\)</span>-th person in the sample. For instance, the table shows that Dan is the four so we’d say <span class="math notranslate nohighlight">\(p = 4\)</span>. So, when talking about the grumpiness <span class="math notranslate nohighlight">\(Y\)</span> of this “Dan” person, whoever he might be, we could refer to his grumpiness by saying that <span class="math notranslate nohighlight">\(Y_p = 91\)</span>, for person <span class="math notranslate nohighlight">\(p = 4\)</span> that is.  However, that’s not the only way we could refer to Dan. As an alternative we could note that Dan belongs to the “uncool” group (<span class="math notranslate nohighlight">\(k = 2\)</span>), and is in fact the first person listed in the uncool group (<span class="math notranslate nohighlight">\(i = 1\)</span>). So it’s equally valid to refer to Dan’s grumpiness by saying that <span class="math notranslate nohighlight">\(Y_{ik} = 91\)</span>, where <span class="math notranslate nohighlight">\(k = 2\)</span> and <span class="math notranslate nohighlight">\(i = 1\)</span>. In other words, each person <span class="math notranslate nohighlight">\(p\)</span> corresponds to a unique <span class="math notranslate nohighlight">\(ik\)</span> combination, and so the formula that I gave above is actually identical to our original formula for the variance, which would be</p>
<div class="math notranslate nohighlight">
\[
\mbox{Var}(Y) = \frac{1}{N} \sum_{p=1}^N  \left(Y_{p} - \bar{Y} \right)^2
\]</div>
<p>In both formulas, all we’re doing is summing over all of the observations in the sample. Most of the time we would just use the simpler <span class="math notranslate nohighlight">\(Y_p\)</span> notation: the equation using <span class="math notranslate nohighlight">\(Y_p\)</span> is clearly the simpler of the two. However, when doing an ANOVA it’s important to keep track of which participants belong in which groups, and we need to use the <span class="math notranslate nohighlight">\(Y_{ik}\)</span> notation to do this.</p>
</div>
<div class="section" id="from-variances-to-sums-of-squares">
<h3><span class="section-number">4.2.2. </span>From variances to sums of squares<a class="headerlink" href="#from-variances-to-sums-of-squares" title="Permalink to this headline">¶</a></h3>
<p>Okay, now that we’ve got a good grasp on how the variance is calculated, let’s define something called the <strong><em>total sum of squares</em></strong>, which is denoted SS<span class="math notranslate nohighlight">\(_{tot}\)</span>. This is very simple: instead of averaging the squared deviations, which is what we do when calculating the variance, we just add them up. So the formula for the total sum of squares is almost identical to the formula for the variance:</p>
<div class="math notranslate nohighlight">
\[
\mbox{SS}_{tot} = \sum_{k=1}^G \sum_{i=1}^{N_k} \left(Y_{ik} - \bar{Y} \right)^2
\]</div>
<p>When we talk about analysing variances in the context of ANOVA, what we’re really doing is working with the total sums of squares rather than the actual variance. One very nice thing about the total sum of squares is that we can break it up into two different kinds of variation. Firstly, we can talk about the <strong><em>within-group sum of squares</em></strong>, in which we look to see how different each individual person is from their own group mean:</p>
<div class="math notranslate nohighlight">
\[
\mbox{SS}_w = \sum_{k=1}^G \sum_{i=1}^{N_k} \left( Y_{ik} - \bar{Y}_k \right)^2
\]</div>
<p>where <span class="math notranslate nohighlight">\(\bar{Y}_k\)</span> is a group mean. In our example, <span class="math notranslate nohighlight">\(\bar{Y}_k\)</span> would be the average mood change experienced by those people given  the <span class="math notranslate nohighlight">\(k\)</span>-th drug. So, instead of comparing individuals to the average of <em>all</em> people in the experiment, we’re only comparing them to those people in the the same group. As a consequence, you’d expect the value of <span class="math notranslate nohighlight">\(\mbox{SS}_w\)</span> to be smaller than the total sum of squares, because it’s completely ignoring any group differences – that is, the fact that the drugs (if they work) will have different effects on people’s moods.</p>
<p>Next, we can define a third notion of variation which captures <em>only</em> the differences between groups. We do this by looking at the differences between the group means <span class="math notranslate nohighlight">\(\bar{Y}_k\)</span> and grand mean <span class="math notranslate nohighlight">\(\bar{Y}\)</span>. In order to quantify the extent of this variation, what we do is calculate the <strong><em>between-group sum of squares</em></strong>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rcl}
\mbox{SS}_{b} &amp;=&amp; \sum_{k=1}^G \sum_{i=1}^{N_k} \left( \bar{Y}_k - \bar{Y} \right)^2
 \\
&amp;=&amp; \sum_{k=1}^G N_k \left( \bar{Y}_k - \bar{Y} \right)^2
\end{array}
\end{split}\]</div>
<p>It’s not too difficult to show that the total variation among people in the experiment <span class="math notranslate nohighlight">\(\mbox{SS}_{tot}\)</span> is actually the sum of the differences between the groups <span class="math notranslate nohighlight">\(\mbox{SS}_b\)</span> and the variation inside the groups <span class="math notranslate nohighlight">\(\mbox{SS}_w\)</span>. That is:</p>
<div class="math notranslate nohighlight">
\[
\mbox{SS}_w  + \mbox{SS}_{b} = \mbox{SS}_{tot}
\]</div>
<p>Yay.</p>
<div class="cell tag_hide-input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">mu1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span>
<span class="n">mu2</span> <span class="o">=</span> <span class="o">-.</span><span class="mi">25</span>
<span class="n">mu3</span> <span class="o">=</span> <span class="mf">3.5</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span>


<span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mu1</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">sigma</span><span class="p">,</span> <span class="n">mu1</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">sigma</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y1</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">mu1</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mu2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">sigma</span><span class="p">,</span> <span class="n">mu2</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">sigma</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y2</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
<span class="n">x3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">mu3</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">sigma</span><span class="p">,</span> <span class="n">mu3</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">sigma</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y3</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">mu3</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>


<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>


<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x3</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x3</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;Between−group variation&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="s1">&#39;(i.e., differences among group means))&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;Within−group variation&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="s1">&#39;(i.e., deviations from group means)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>


<span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu1</span><span class="p">,</span><span class="mi">18</span><span class="p">),</span> <span class="n">xytext</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu2</span><span class="p">,</span><span class="mi">18</span><span class="p">),</span> <span class="n">arrowprops</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;&lt;-&gt;&#39;</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu2</span><span class="p">,</span><span class="mi">18</span><span class="p">),</span> <span class="n">xytext</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu3</span><span class="p">,</span><span class="mi">18</span><span class="p">),</span> <span class="n">arrowprops</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;&lt;-&gt;&#39;</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu1</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span> <span class="n">xytext</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu3</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span> <span class="n">arrowprops</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;&lt;-&gt;&#39;</span><span class="p">))</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu1</span><span class="o">-</span><span class="p">(</span><span class="n">sigma</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="mi">18</span><span class="p">),</span> <span class="n">xytext</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu1</span><span class="o">+</span><span class="p">(</span><span class="n">sigma</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="mi">18</span><span class="p">),</span> <span class="n">arrowprops</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;&lt;-&gt;&#39;</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu2</span><span class="o">-</span><span class="p">(</span><span class="n">sigma</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="mi">18</span><span class="p">),</span> <span class="n">xytext</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu2</span><span class="o">+</span><span class="p">(</span><span class="n">sigma</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="mi">18</span><span class="p">),</span> <span class="n">arrowprops</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;&lt;-&gt;&#39;</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu3</span><span class="o">-</span><span class="p">(</span><span class="n">sigma</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="mi">18</span><span class="p">),</span> <span class="n">xytext</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu3</span><span class="o">+</span><span class="p">(</span><span class="n">sigma</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="mi">18</span><span class="p">),</span> <span class="n">arrowprops</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s1">&#39;&lt;-&gt;&#39;</span><span class="p">))</span>


<span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>


<span class="n">ax1</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;anovavar_fig&quot;</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/05.03-anova_19_1.png" src="_images/05.03-anova_19_1.png" />
</div>
</div>
<div class="figure align-default" id="fig-anovavar" style="width: 600px">
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;drug&#39;, ylabel=&#39;mood_gain&#39;&gt;
</pre></div>
</div>
</div>
<p class="caption"><span class="caption-number">Fig. 4.8 </span><span class="caption-text">Graphical illustration of “between groups” variation (panel a) and “within groups” variation (panel b). On the left, the arrows show the differences in the group means; on the right, the arrows highlight the variability within each group.</span><a class="headerlink" href="#fig-anovavar" title="Permalink to this image">¶</a></p>
</div>
<p>Okay, so what have we found out? We’ve discovered that the total variability associated with the outcome variable (<span class="math notranslate nohighlight">\(\mbox{SS}_{tot}\)</span>) can be mathematically carved up into the sum of “the variation due to the differences in the sample means for the different groups” (<span class="math notranslate nohighlight">\(\mbox{SS}_{b}\)</span>) plus “all the rest of the variation” (<span class="math notranslate nohighlight">\(\mbox{SS}_{w}\)</span>). How does that help me find out whether the groups have different population means? Um. Wait. Hold on a second… now that I think about it, this is <em>exactly</em> what we were looking for. If the null hypothesis is true, then you’d expect all the sample means to be pretty similar to each other, right? And that would imply that you’d expect <span class="math notranslate nohighlight">\(\mbox{SS}_{b}\)</span> to be really small, or at least you’d expect it to be a lot smaller than the “the variation associated with everything else”, <span class="math notranslate nohighlight">\(\mbox{SS}_{w}\)</span>. Hm. I detect a hypothesis test coming on…</p>
</div>
<div class="section" id="from-sums-of-squares-to-the-f-test">
<h3><span class="section-number">4.2.3. </span>From sums of squares to the <span class="math notranslate nohighlight">\(F\)</span>-test<a class="headerlink" href="#from-sums-of-squares-to-the-f-test" title="Permalink to this headline">¶</a></h3>
<p>As we saw in the last section, the <em>qualitative</em> idea behind ANOVA is to compare the two sums of squares values <span class="math notranslate nohighlight">\(\mbox{SS}_b\)</span> and <span class="math notranslate nohighlight">\(\mbox{SS}_w\)</span> to each other: if the between-group variation is <span class="math notranslate nohighlight">\(\mbox{SS}_b\)</span> is large relative to the within-group variation <span class="math notranslate nohighlight">\(\mbox{SS}_w\)</span> then we have reason to suspect that the population means for the different groups aren’t identical to each other. In order to convert this into a workable hypothesis test, there’s a little bit of “fiddling around” needed. What I’ll do is first show you <em>what</em> we do to calculate our test statistic – which is called an <strong><em><span class="math notranslate nohighlight">\(F\)</span> ratio</em></strong> – and then try to give you a feel for <em>why</em> we do it this way.</p>
<p>In order to convert our SS values into an <span class="math notranslate nohighlight">\(F\)</span>-ratio, the first thing we need to calculate is the <strong><em>degrees of freedom</em></strong> associated with the SS<span class="math notranslate nohighlight">\(_b\)</span> and SS<span class="math notranslate nohighlight">\(_w\)</span> values. As usual, the degrees of freedom corresponds to the number of unique “data points” that contribute to a particular calculation, minus the number of “constraints” that they need to satisfy. For the within-groups variability, what we’re calculating is the variation of the individual observations (<span class="math notranslate nohighlight">\(N\)</span> data points) around the group means (<span class="math notranslate nohighlight">\(G\)</span> constraints). In contrast, for the between groups variability, we’re interested in the variation of the group means (<span class="math notranslate nohighlight">\(G\)</span> data points) around the grand mean (1 constraint). Therefore, the degrees of freedom here are:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{lcl}
\mbox{df}_b &amp;=&amp; G-1 \\
\mbox{df}_w &amp;=&amp; N-G \\
\end{array}
\end{split}\]</div>
<p>Okay, that seems simple enough. What we do next is convert our summed squares value into a “mean squares” value, which we do by dividing by the degrees of freedom:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{lcl}
\mbox{MS}_b &amp;=&amp; \displaystyle\frac{\mbox{SS}_b }{ \mbox{df}_b} \\
\mbox{MS}_w &amp;=&amp; \displaystyle\frac{\mbox{SS}_w }{ \mbox{df}_w} 
\end{array}
\end{split}\]</div>
<p>Finally, we calculate the <span class="math notranslate nohighlight">\(F\)</span>-ratio by dividing the between-groups MS by the within-groups MS:</p>
<div class="math notranslate nohighlight">
\[
F = \frac{\mbox{MS}_b }{ \mbox{MS}_w } 
\]</div>
<p>At a very general level, the intuition behind the <span class="math notranslate nohighlight">\(F\)</span> statistic is straightforward: bigger values of <span class="math notranslate nohighlight">\(F\)</span> means that the between-groups variation is large, relative to the within-groups variation. As a consequence, the larger the value of <span class="math notranslate nohighlight">\(F\)</span>, the more evidence we have against the null hypothesis. But how large does <span class="math notranslate nohighlight">\(F\)</span> have to be in order to actually <em>reject</em> <span class="math notranslate nohighlight">\(H_0\)</span>? In order to understand this, you need a slightly deeper understanding of what ANOVA is and what the mean squares values actually are.</p>
<p>The next section discusses that in a bit of detail, but for readers that aren’t interested in the details of what the test is actually measuring, I’ll cut to the chase. In order to complete our hypothesis test, we need to know the sampling distribution for <span class="math notranslate nohighlight">\(F\)</span> if the null hypothesis is true. Not surprisingly, the sampling distribution for the <span class="math notranslate nohighlight">\(F\)</span> <em>statistic</em> under the null hypothesis is an <span class="math notranslate nohighlight">\(F\)</span> <em>distribution</em>. If you recall back to our discussion of the <span class="math notranslate nohighlight">\(F\)</span> distribution in <a class="reference internal" href="04.02-probability.html#probability"><span class="std std-ref">Introduction to Probability</span></a>, the <span class="math notranslate nohighlight">\(F\)</span> distribution has two parameters, corresponding to the two degrees of freedom involved: the first one df<span class="math notranslate nohighlight">\(_1\)</span> is the between groups degrees of freedom df<span class="math notranslate nohighlight">\(_b\)</span>, and the second one df<span class="math notranslate nohighlight">\(_2\)</span> is the within groups degrees of freedom df<span class="math notranslate nohighlight">\(_w\)</span>.</p>
<p>A summary of all the key quantities involved in a one-way ANOVA, including the formulas showing how they are calculated, is shown in the table below:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p></p></th>
<th class="text-align:left head"><p>df</p></th>
<th class="text-align:left head"><p>sum of squares</p></th>
<th class="text-align:left head"><p>mean squares</p></th>
<th class="text-align:left head"><p><span class="math notranslate nohighlight">\(F\)</span> statistic</p></th>
<th class="text-align:left head"><p><span class="math notranslate nohighlight">\(p\)</span> value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>between groups</p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\(\mbox{df}_b = G-1\)</span></p></td>
<td class="text-align:left"><p>SS<span class="math notranslate nohighlight">\(_b = \displaystyle\sum_{k=1}^G N_k (\bar{Y}_k - \bar{Y})^2\)</span></p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\(\mbox{MS}_b = \frac{\mbox{SS}_b}{\mbox{df}_b}\)</span></p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\(F = \frac{\mbox{MS}_b }{ \mbox{MS}_w }\)</span></p></td>
<td class="text-align:left"><p>[complicated]</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>within groups</p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\(\mbox{df}_w = N-G\)</span></p></td>
<td class="text-align:left"><p>SS<span class="math notranslate nohighlight">\(_w = \sum_{k=1}^G \sum_{i = 1}^{N_k} ( {Y}_{ik} - \bar{Y}_k)^2\)</span></p></td>
<td class="text-align:left"><p><span class="math notranslate nohighlight">\(\mbox{MS}_w =  \frac{\mbox{SS}_w}{\mbox{df}_w}\)</span></p></td>
<td class="text-align:left"><p>-</p></td>
<td class="text-align:left"><p>-</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="the-model-for-the-data-and-the-meaning-of-f-advanced">
<span id="anovamodel"></span><h3><span class="section-number">4.2.4. </span>The model for the data and the meaning of <span class="math notranslate nohighlight">\(F\)</span> (advanced)<a class="headerlink" href="#the-model-for-the-data-and-the-meaning-of-f-advanced" title="Permalink to this headline">¶</a></h3>
<p>At a fundamental level, ANOVA is a competition between two different statistical models, <span class="math notranslate nohighlight">\(H_0\)</span> and <span class="math notranslate nohighlight">\(H_1\)</span>. When I described the null and alternative hypotheses at the start of the section, I was a little imprecise about what these models actually are. I’ll remedy that now, though you probably won’t like me for doing so. If you recall, our null hypothesis was that all of the group means are identical to one another. If so, then a natural way to think about the outcome variable <span class="math notranslate nohighlight">\(Y_{ik}\)</span> is to describe individual scores in terms of a single population mean <span class="math notranslate nohighlight">\(\mu\)</span>, plus the deviation from that population mean. This deviation is usually denoted <span class="math notranslate nohighlight">\(\epsilon_{ik}\)</span> and is traditionally called the <em>error</em> or <strong><em>residual</em></strong> associated with that observation. Be careful though: just like we saw with the word “significant”, the word “error” has a technical meaning in statistics that isn’t quite the same as its everyday English definition. In everyday language, “error” implies a mistake of some kind; in statistics, it doesn’t (or at least, not necessarily). With that in mind, the word “residual” is a better term than the word “error”. In statistics, both words mean “leftover variability”: that is, “stuff” that the model can’t explain. In any case, here’s what the null hypothesis looks like when we write it as a statistical model:</p>
<div class="math notranslate nohighlight">
\[
Y_{ik} = \mu + \epsilon_{ik}
\]</div>
<p>where we make the <em>assumption</em> (discussed later) that the residual values <span class="math notranslate nohighlight">\(\epsilon_{ik}\)</span> are normally distributed, with mean 0 and a standard deviation <span class="math notranslate nohighlight">\(\sigma\)</span> that is the same for all groups. To use the notation that we introduced in <a class="reference internal" href="04.02-probability.html#probability"><span class="std std-ref">Introduction to Probability</span></a> we would write this assumption like this:</p>
<div class="math notranslate nohighlight">
\[
\epsilon_{ik} \sim \mbox{Normal}(0, \sigma^2)
\]</div>
<p>What about the alternative hypothesis, <span class="math notranslate nohighlight">\(H_1\)</span>? The only difference between the null hypothesis and the alternative hypothesis is that we allow each group to have a different population mean. So, if we let <span class="math notranslate nohighlight">\(\mu_k\)</span> denote the population mean for the <span class="math notranslate nohighlight">\(k\)</span>-th group in our experiment, then the statistical model corresponding to <span class="math notranslate nohighlight">\(H_1\)</span> is:</p>
<div class="math notranslate nohighlight">
\[
Y_{ik} = \mu_k + \epsilon_{ik}
\]</div>
<p>where, once again, we assume that the error terms are normally distributed with mean 0 and standard deviation <span class="math notranslate nohighlight">\(\sigma\)</span>. That is, the alternative hypothesis also assumes that</p>
<div class="math notranslate nohighlight">
\[
\epsilon \sim \mbox{Normal}(0, \sigma^2)
\]</div>
<p>Okay, now that we’ve described the statistical models underpinning <span class="math notranslate nohighlight">\(H_0\)</span> and <span class="math notranslate nohighlight">\(H_1\)</span> in more detail, it’s now pretty straightforward to say what the mean square values are measuring, and what this means for the interpretation of <span class="math notranslate nohighlight">\(F\)</span>. I won’t bore you with the proof of this, but it turns out that the within-groups mean square, MS<span class="math notranslate nohighlight">\(_w\)</span>, can be viewed as an estimator (in the technical sense: <a class="reference internal" href="04.03-estimation.html#estimation"><span class="std std-ref">estimation</span></a> of the error variance <span class="math notranslate nohighlight">\(\sigma^2\)</span>.  The between-groups mean square MS<span class="math notranslate nohighlight">\(_b\)</span> is also an estimator; but what it estimates is the error variance <em>plus</em> a quantity that depends on the true differences among the group means. If we call this quantity <span class="math notranslate nohighlight">\(Q\)</span>, then we can see that the <span class="math notranslate nohighlight">\(F\)</span>-statistic is basically <a class="footnote-reference brackets" href="#note2" id="id2">2</a></p>
<div class="math notranslate nohighlight">
\[
F = \frac{\hat{Q} + \hat\sigma^2}{\hat\sigma^2}
\]</div>
<p>where the true value <span class="math notranslate nohighlight">\(Q=0\)</span> if the null hypothesis is true, and <span class="math notranslate nohighlight">\(Q &gt; 0\)</span> if the alternative hypothesis is true (e.g. ch. 10 <span id="id3">[<a class="reference internal" href="bibliography.html#id73"><span>Hay94</span></a>]</span>). Therefore, at a bare minimum <em>the <span class="math notranslate nohighlight">\(F\)</span> value must be larger than 1</em> to have any chance of rejecting the null hypothesis. Note that this <em>doesn’t</em> mean that it’s impossible to get an <span class="math notranslate nohighlight">\(F\)</span>-value less than 1. What it means is that, if the null hypothesis is true the sampling distribution of the <span class="math notranslate nohighlight">\(F\)</span> ratio has a mean of 1,<a class="footnote-reference brackets" href="#note3" id="id4">3</a> and so we need to see <span class="math notranslate nohighlight">\(F\)</span>-values larger than 1 in order to safely reject the null.</p>
<p>To be a bit more precise about the sampling distribution, notice that if the null hypothesis is true, both MS<span class="math notranslate nohighlight">\(_b\)</span> and MS<span class="math notranslate nohighlight">\(_w\)</span> are estimators of the variance of the residuals <span class="math notranslate nohighlight">\(\epsilon_{ik}\)</span>. If those residuals are normally distributed, then you might suspect that the estimate of the variance of <span class="math notranslate nohighlight">\(\epsilon_{ik}\)</span> is chi-square distributed… because (as discussed in <a class="reference internal" href="04.02-probability.html#otherdists"><span class="std std-ref">Other useful distributions</span></a> that’s what a chi-square distribution <em>is</em>: it’s what you get when you square a bunch of normally-distributed things and add them up. And since the <span class="math notranslate nohighlight">\(F\)</span> distribution is (again, by definition) what you get when you take the ratio between two things that are <span class="math notranslate nohighlight">\(\chi^2\)</span> distributed… we have our sampling distribution. Obviously, I’m glossing over a whole lot of stuff when I say this, but in broad terms, this really is where our sampling distribution comes from.</p>
</div>
<div class="section" id="a-worked-example">
<span id="anovacalc"></span><h3><span class="section-number">4.2.5. </span>A worked example<a class="headerlink" href="#a-worked-example" title="Permalink to this headline">¶</a></h3>
<p>The previous discussion was fairly abstract, and a little on the technical side, so I think that at this point it might be useful to see a worked example. For that, let’s go back to the clinical trial data that I introduced at the start of the chapter. The descriptive statistics that we calculated at the beginning tell us our group means: an average mood gain of 0.45 for the placebo, 0.72 for Anxifree, and 1.48 for Joyzepam. With that in mind, let’s party like it’s 1899 <a class="footnote-reference brackets" href="#note4" id="id5">4</a> and  start doing some pencil and paper calculations. I’ll only do this for the first 5 observations, because it’s not bloody 1899 and I’m very lazy. Let’s start by calculating <span class="math notranslate nohighlight">\(\mbox{SS}_{w}\)</span>, the within-group sums of squares. First, let’s draw up a nice table to help us with our calculations…</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>group (<span class="math notranslate nohighlight">\(k\)</span>)</p></th>
<th class="text-align:left head"><p>outcome (<span class="math notranslate nohighlight">\(Y_{ik}\)</span>)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>placebo</p></td>
<td class="text-align:left"><p>0.5</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>placebo</p></td>
<td class="text-align:left"><p>0.3</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>placebo</p></td>
<td class="text-align:left"><p>0.1</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>anxifree</p></td>
<td class="text-align:left"><p>0.6</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>anxifree</p></td>
<td class="text-align:left"><p>0.4</p></td>
</tr>
</tbody>
</table>
<p>At this stage, the only thing I’ve included in the table is the raw data itself: that is, the grouping variable (i.e., <code class="docutils literal notranslate"><span class="pre">drug</span></code>) and outcome variable (i.e. <code class="docutils literal notranslate"><span class="pre">mood_gain</span></code>) for each person. Note that the outcome variable here corresponds to the <span class="math notranslate nohighlight">\(Y_{ik}\)</span> value in our equation previously. The next step in the calculation is to write down, for each person in the study, the corresponding group mean; that is, <span class="math notranslate nohighlight">\(\bar{Y}_k\)</span>. This is slightly repetitive, but not particularly difficult since we already calculated those group means when doing our descriptive statistics:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>group (<span class="math notranslate nohighlight">\(k\)</span>)</p></th>
<th class="text-align:left head"><p>outcome (<span class="math notranslate nohighlight">\(Y_{ik}\)</span>)</p></th>
<th class="text-align:left head"><p><strong>group mean</strong> (<span class="math notranslate nohighlight">\(\bar{Y}_k\)</span>)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>placebo</p></td>
<td class="text-align:left"><p>0.5</p></td>
<td class="text-align:left"><p><strong>0.45</strong></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>placebo</p></td>
<td class="text-align:left"><p>0.3</p></td>
<td class="text-align:left"><p><strong>0.45</strong></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>placebo</p></td>
<td class="text-align:left"><p>0.1</p></td>
<td class="text-align:left"><p><strong>0.45</strong></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>anxifree</p></td>
<td class="text-align:left"><p>0.6</p></td>
<td class="text-align:left"><p><strong>0.72</strong></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>anxifree</p></td>
<td class="text-align:left"><p>0.4</p></td>
<td class="text-align:left"><p><strong>0.72</strong></p></td>
</tr>
</tbody>
</table>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>
<span class="n">Now</span> <span class="n">that</span> <span class="n">we</span><span class="s1">&#39;ve written those down, we need to calculate -- again for every person -- the deviation from the corresponding group mean. That is, we want to subtract $Y_</span><span class="si">{ik}</span><span class="s1"> - </span><span class="se">\b</span><span class="s1">ar</span><span class="si">{Y}</span><span class="s1">_k$. After we&#39;</span><span class="n">ve</span> <span class="n">done</span> <span class="n">that</span><span class="p">,</span> <span class="n">we</span> <span class="n">need</span> <span class="n">to</span> <span class="n">square</span> <span class="n">everything</span><span class="o">.</span> <span class="n">When</span> <span class="n">we</span> <span class="n">do</span> <span class="n">that</span><span class="p">,</span> <span class="n">here</span><span class="s1">&#39;s what we get:</span>
</pre></div>
</div>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p>group (<span class="math notranslate nohighlight">\(k\)</span>)</p></th>
<th class="text-align:left head"><p>outcome (<span class="math notranslate nohighlight">\(Y_{ik}\)</span>)</p></th>
<th class="text-align:left head"><p>group mean (<span class="math notranslate nohighlight">\(\bar{Y}_k\)</span>)</p></th>
<th class="text-align:left head"><p><strong>dev.\ from group mean</strong> (<span class="math notranslate nohighlight">\(Y_{ik} - \bar{Y}_{k}\)</span>)</p></th>
<th class="text-align:left head"><p><strong>squared deviation</strong> (<span class="math notranslate nohighlight">\((Y_{ik} - \bar{Y}_{k})^2\)</span>)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>placebo</p></td>
<td class="text-align:left"><p>0.5</p></td>
<td class="text-align:left"><p>0.45</p></td>
<td class="text-align:left"><p><strong>0.05</strong></p></td>
<td class="text-align:left"><p><strong>0.0025</strong></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>placebo</p></td>
<td class="text-align:left"><p>0.3</p></td>
<td class="text-align:left"><p>0.45</p></td>
<td class="text-align:left"><p><strong>-0.15</strong></p></td>
<td class="text-align:left"><p><strong>0.0225</strong></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>placebo</p></td>
<td class="text-align:left"><p>0.1</p></td>
<td class="text-align:left"><p>0.45</p></td>
<td class="text-align:left"><p><strong>-0.35</strong></p></td>
<td class="text-align:left"><p><strong>0.1225</strong></p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>anxifree</p></td>
<td class="text-align:left"><p>0.6</p></td>
<td class="text-align:left"><p>0.72</p></td>
<td class="text-align:left"><p><strong>-0.12</strong></p></td>
<td class="text-align:left"><p><strong>0.0136</strong></p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>anxifree</p></td>
<td class="text-align:left"><p>0.4</p></td>
<td class="text-align:left"><p>0.72</p></td>
<td class="text-align:left"><p><strong>-0.32</strong></p></td>
<td class="text-align:left"><p><strong>0.1003</strong></p></td>
</tr>
</tbody>
</table>
<p>The last step is equally straightforward. In order to calculate the within-group sum of squares, we just add up  the squared deviations across all observations:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}{rcl}
\mbox{SS}_w &amp;=&amp; 0.0025 + 0.0225 + 0.1225 + 0.0136 + 0.1003 \\
&amp;=&amp; 0.2614
\end{array}
\end{split}\]</div>
<p>Of course, if we actually wanted to get the <em>right</em> answer, we’d need to do this for all 18 observations in the data set, not just the first five. We could continue with the pencil and paper calculations if we wanted to, but it’s pretty tedious. Alternatively, it’s not too hard to get Python to do it. Here’s how:</p>
<p>It might not be obvious from inspection what these commands are doing: as a general rule, the human brain seems to just shut down when faced with a big block of programming. However, I strongly suggest that – if you’re like me and tend to find that the mere sight of this code makes you want to look away and see if there’s any beer left in the fridge or a game of footy on the telly – you take a moment and look closely at these commands one at a time. Every single one of these commands is something you’ve seen before somewhere else in the book. There’s nothing novel about them (though I’ll have to admit that the <code class="docutils literal notranslate"><span class="pre">tapply()</span></code> function takes a while to get a handle on), so if you’re not quite sure how these commands work, this might be a good time to try playing around with them yourself, to try to get a sense of what’s happening. On the other hand, if this does seem to make sense, then you won’t be all that surprised at what happens when I wrap these variables in a data frame, and print it out…</p>
<p>If you compare this output to the contents of the table I’ve been constructing by hand, you can see that R has done exactly the same calculations that I was doing, and much faster too. So, if we want to finish the calculations of the within-group sum of squares in R, we just ask for the <code class="docutils literal notranslate"><span class="pre">sum()</span></code> of the <code class="docutils literal notranslate"><span class="pre">squared.devs</span></code> variable:</p>
<p>Obviously, this isn’t the same as what I calculated, because R used all 18 observations. But if I’d typed <code class="docutils literal notranslate"><span class="pre">sum(</span> <span class="pre">squared.devs[1:5]</span> <span class="pre">)</span></code> instead, it would have given the same answer that I got earlier.</p>
<p>Okay. Now that we’ve calculated the within groups variation, <span class="math notranslate nohighlight">\(\mbox{SS}_w\)</span>, it’s time to turn our attention to the between-group sum of squares, <span class="math notranslate nohighlight">\(\mbox{SS}_b\)</span>. The calculations for this case are very similar. The main difference is that, instead of calculating the differences between an observation <span class="math notranslate nohighlight">\(Y_{ik}\)</span> and a group mean <span class="math notranslate nohighlight">\(\bar{Y}_k\)</span> for all of the observations, we calculate the differences between the group means <span class="math notranslate nohighlight">\(\bar{Y}_k\)</span> and the grand mean <span class="math notranslate nohighlight">\(\bar{Y}\)</span> (in this case 0.88) for all of the groups…</p>
<div class="highlight-{r notranslate"><div class="highlight"><pre><span></span>knitr::kable(tibble::tribble(
         ~V1,            ~V2,          ~V3,                         ~V4,                             ~V5,
   &quot;placebo&quot;,         &quot;0.45&quot;,       &quot;0.88&quot;,                     &quot;-0.43&quot;,                          &quot;0.18&quot;,
  &quot;anxifree&quot;,         &quot;0.72&quot;,       &quot;0.88&quot;,                     &quot;-0.16&quot;,                          &quot;0.03&quot;,
  &quot;joyzepam&quot;,         &quot;1.48&quot;,       &quot;0.88&quot;,                      &quot;0.60&quot;,                          &quot;0.36&quot;
  ), col.names = c(&quot;group ($k$)&quot;,   &quot;group mean ($\\bar{Y}_k$)&quot;, &quot;grand mean ($\\bar{Y}$)&quot;,                 &quot;deviation ($\\bar{Y}_{k} - \\bar{Y}$)&quot;,            &quot;squared deviations ($(\\bar{Y}_{k} - \\bar{Y})^2$)&quot;))
</pre></div>
</div>
<p>However, for the between group calculations we need to multiply each of these squared deviations by <span class="math notranslate nohighlight">\(N_k\)</span>, the number of observations in the group. We do this because every <em>observation</em> in the group (all <span class="math notranslate nohighlight">\(N_k\)</span> of them) is associated with a between group difference. So if there are six people in the placebo group, and the placebo group mean differs from the grand mean by 0.19, then the <em>total</em> between group variation associated with these six people is <span class="math notranslate nohighlight">\(6 \times 0.16 = 1.14\)</span>. So we have to extend our little table of calculations…</p>
<div class="highlight-{r notranslate"><div class="highlight"><pre><span></span>knitr::kable(tibble::tribble(
         ~V1,                             ~V2,           ~V3,                                 ~V4,
   &quot;placebo&quot;,                          &quot;0.18&quot;,           &quot;6&quot;,                              &quot;1.11&quot;,
  &quot;anxifree&quot;,                          &quot;0.03&quot;,           &quot;6&quot;,                              &quot;0.16&quot;,
  &quot;joyzepam&quot;,                          &quot;0.36&quot;,           &quot;6&quot;,                              &quot;2.18&quot;
  ), col.names = c(     &quot;group ($k$)&quot;,            &quot;squared deviations ($(\\bar{Y}_{k} - \\bar{Y})^2$)&quot;, &quot;sample size ($N_k$)&quot;,              &quot;weighted squared dev ($N_k (\\bar{Y}_{k} - \\bar{Y})^2$)&quot;))
</pre></div>
</div>
<p>And so now our between group sum of squares is obtained by summing these “weighted squared deviations” over all three groups in the study:
$<span class="math notranslate nohighlight">\(
\begin{array}{rcl}
\mbox{SS}_{b} &amp;=&amp; 1.11 + 0.16 + 2.18 \\
&amp;=&amp; 3.45
\end{array}
\)</span>$
As you can see, the between group calculations are a lot shorter, so you probably wouldn’t usually want to bother using R as your calculator. However, if you <em>did</em> decide to do so, here’s one way you could do it:</p>
<p>Again, I won’t actually try to explain this code line by line, but – just like last time – there’s nothing in there that we haven’t seen in several places elsewhere in the book, so I’ll leave it as an exercise for you to make sure you understand it. Once again, we can dump all our variables into a data frame so that we can print it out as a nice table:</p>
<p>Clearly, these are basically the same numbers that we got before. There are a few tiny differences, but that’s only because the hand-calculated versions have some small errors caused by the fact that I rounded all my numbers to 2 decimal places at each step in the calculations, whereas R only does it at the end (obviously, R s version is more accurate). Anyway, here’s the R command showing the final step:</p>
<p>which is (ignoring the slight differences due to rounding error) the same answer that I got when doing things by hand.</p>
<p>Now that we’ve calculated our sums of squares values, <span class="math notranslate nohighlight">\(\mbox{SS}_b\)</span> and <span class="math notranslate nohighlight">\(\mbox{SS}_w\)</span>, the rest of the ANOVA is pretty painless. The next step is to calculate the degrees of freedom. Since we have <span class="math notranslate nohighlight">\(G = 3\)</span> groups and <span class="math notranslate nohighlight">\(N = 18\)</span> observations in total, our degrees of freedom can be calculated by simple subtraction:
$<span class="math notranslate nohighlight">\(
\begin{array}{lclcl}
\mbox{df}_b &amp;=&amp; G - 1 &amp;=&amp; 2 \\
\mbox{df}_w &amp;=&amp; N - G &amp;=&amp; 15 
\end{array}
\)</span><span class="math notranslate nohighlight">\(
Next, since we've now calculated the values for the sums of squares and the degrees of freedom, for both the within-groups variability and the between-groups variability, we can obtain the mean square values by dividing one by the other:
\)</span><span class="math notranslate nohighlight">\(
\begin{array}{lclclcl}
\mbox{MS}_b &amp;=&amp; \displaystyle\frac{\mbox{SS}_b }{  \mbox{df}_b } &amp;=&amp; \displaystyle\frac{3.45}{ 2}  &amp;=&amp; 1.73
\end{array}
\)</span><span class="math notranslate nohighlight">\(
\)</span><span class="math notranslate nohighlight">\(
\begin{array}{lclclcl}
\mbox{MS}_w &amp;=&amp; \displaystyle\frac{\mbox{SS}_w }{  \mbox{df}_w } &amp;=&amp; \displaystyle\frac{1.39}{15} &amp;=&amp; 0.09
\end{array}
\)</span><span class="math notranslate nohighlight">\(
We're almost done. The mean square values can be used to calculate the \)</span>F<span class="math notranslate nohighlight">\(-value, which is the test statistic that we're interested in. We do this by dividing the between-groups MS value by the and within-groups MS value.
\)</span><span class="math notranslate nohighlight">\(
F \ = \ \frac{\mbox{MS}_b }{ \mbox{MS}_w } \ = \ \frac{1.73}{0.09} \ = \ 18.6
\)</span><span class="math notranslate nohighlight">\(
Woohooo! This is terribly exciting, yes? Now that we have our test statistic, the last step is to find out whether the test itself gives us a significant result. As discussed in Chapter \&#64;ref(hypothesistesting, what we really *ought* to do is choose an \)</span>\alpha<span class="math notranslate nohighlight">\( level (i.e., acceptable Type I error rate) ahead of time, construct our rejection region, etc etc. But in practice it's just easier to directly calculate the \)</span>p<span class="math notranslate nohighlight">\(-value. Back in the &quot;old days&quot;, what we'd do is open up a statistics textbook or something and flick to the back section which would actually have a huge lookup table... that's how we'd &quot;compute&quot; our \)</span>p<span class="math notranslate nohighlight">\(-value, because it's too much effort to do it any other way. However, since we have access to R, I'll use the `pf()` function to do it instead. Now, remember that I explained earlier that the \)</span>F<span class="math notranslate nohighlight">\(-test is always one sided? And that we only reject the null hypothesis for very large \)</span>F<span class="math notranslate nohighlight">\(-values? That means we're only interested in the *upper tail* of the \)</span>F$-distribution. The command that you’d use here would be this…</p>
<p>Therefore, our <span class="math notranslate nohighlight">\(p\)</span>-value comes to 0.0000867, or <span class="math notranslate nohighlight">\(8.67 \times 10^{-5}\)</span> in scientific notation. So, unless we’re being <em>extremely</em> conservative about our Type I error rate, we’re pretty much guaranteed to reject the null hypothesis.</p>
<p>At this point, we’re basically done. Having completed our calculations, it’s traditional to organise all these numbers into an ANOVA table like the one in Table&#64;reftab:anovatable. For our clinical trial data, the ANOVA table would look like this:</p>
<div class="highlight-{r notranslate"><div class="highlight"><pre><span></span>knitr::kable(tibble::tribble(
               ~V1,  ~V2,              ~V3,            ~V4,             ~V5,                      ~V6,
  &quot;between groups&quot;,  &quot;2&quot;,           &quot;3.45&quot;,         &quot;1.73&quot;,          &quot;18.6&quot;, &quot;$8.67 \\times 10^{-5}$&quot;,
   &quot;within groups&quot;, &quot;15&quot;,           &quot;1.39&quot;,         &quot;0.09&quot;,             &quot;-&quot;,                      &quot;-&quot;
  ), col.names = c(&quot;&quot;, &quot;df&quot;, &quot;sum of squares&quot;, &quot;mean squares&quot;, &quot;$F$-statistic&quot;, &quot;$p$-value&quot;))
</pre></div>
</div>
<p>These days, you’ll probably never have much reason to want to construct one of these tables yourself, but you <em>will</em> find that almost all statistical software (R included) tends to organise the output of an ANOVA into a table like this, so it’s a good idea to get used to reading them. However, although the software will output a full ANOVA table, there’s almost never a good reason to include the whole table in your write up. A pretty standard way of reporting this result would be to write something like this:</p>
<blockquote>
<div><p>One-way ANOVA showed a significant effect of drug on mood gain (<span class="math notranslate nohighlight">\(F(2,15) = 18.6, p&lt;.001\)</span>).</p>
</div></blockquote>
<p>Sigh. So much work for one short sentence.</p>
</div>
</div>
<div class="section" id="running-an-anova-in-python">
<span id="introduceaov"></span><h2><span class="section-number">4.3. </span>Running an ANOVA in Python<a class="headerlink" href="#running-an-anova-in-python" title="Permalink to this headline">¶</a></h2>
<p>I’m pretty sure I know what you’re thinking after reading the last section, <em>especially</em> if you followed my advice and tried typing all the commands in yourself…. doing the ANOVA calculations yourself <em>sucks</em>. There’s quite a lot of calculations that we needed to do along the way, and it would be tedious to have to do this over and over again every time you wanted to do an ANOVA. One possible solution to the problem would be to take all these calculations and turn them into some R functions yourself. You’d still have to do a lot of typing, but at least you’d only have to do it the one time: once you’ve created the functions, you can reuse them over and over again. However, writing your own functions is a lot of work, so this is kind of a last resort. Besides, it’s much better if someone else does all the work for you…</p>
<div class="section" id="using-the-aov-function-to-specify-your-anova">
<h3><span class="section-number">4.3.1. </span>Using the <code class="docutils literal notranslate"><span class="pre">aov()</span></code> function to specify your ANOVA<a class="headerlink" href="#using-the-aov-function-to-specify-your-anova" title="Permalink to this headline">¶</a></h3>
<p>To make life easier for you, R provides a function called <code class="docutils literal notranslate"><span class="pre">aov()</span></code>, which – obviously – is an acronym of “Analysis Of Variance”.^[Actually, it <em>also</em> provides a function called <code class="docutils literal notranslate"><span class="pre">anova()</span></code>, but that works a bit differently, so let’s just ignore it for now.] If you type <code class="docutils literal notranslate"><span class="pre">?aov</span></code> and have a look at the help documentation, you’ll see that there are several arguments to the <code class="docutils literal notranslate"><span class="pre">aov()</span></code> function, but the only two that we’re interested in are <code class="docutils literal notranslate"><span class="pre">formula</span></code> and <code class="docutils literal notranslate"><span class="pre">data</span></code>. As we’ve seen in a few places previously, the <code class="docutils literal notranslate"><span class="pre">formula</span></code> argument is what you use to specify the outcome variable and the grouping variable, and the <code class="docutils literal notranslate"><span class="pre">data</span></code> argument is what you use to specify the data frame that stores these variables. In other words, to do the same ANOVA that I laboriously calculated in the previous section, I’d use a command like this:</p>
<div class="highlight-{r notranslate"><div class="highlight"><pre><span></span>aov( formula = mood.gain ~ drug, data = clin.trial ) 
</pre></div>
</div>
<p>Actually, that’s not <em>quite</em> the whole story, as you’ll see as soon as you look at the output from this command, which I’ve hidden for the moment in order to avoid confusing you. Before we go into specifics, I should point out that either of these commands will do the same thing:</p>
<div class="highlight-{r notranslate"><div class="highlight"><pre><span></span>aov( clin.trial$mood.gain ~ clin.trial$drug ) 
aov( mood.gain ~ drug, clin.trial ) 
</pre></div>
</div>
<p>In the first command, I didn’t specify a <code class="docutils literal notranslate"><span class="pre">data</span></code> set, and instead relied on the <code class="docutils literal notranslate"><span class="pre">$</span></code> operator to tell R how to find the variables. In the second command, I dropped the argument names, which is okay in this case because <code class="docutils literal notranslate"><span class="pre">formula</span></code> is the first argument to the <code class="docutils literal notranslate"><span class="pre">aov()</span></code> function, and <code class="docutils literal notranslate"><span class="pre">data</span></code> is the second one. Regardless of how I specify the ANOVA, I can assign the output of the <code class="docutils literal notranslate"><span class="pre">aov()</span></code> function to a variable, like this for example:</p>
<div class="highlight-{r notranslate"><div class="highlight"><pre><span></span>my.anova &lt;- aov( mood.gain ~ drug, clin.trial ) 
</pre></div>
</div>
<p>This is almost always a good thing to do, because there’s <em>lots</em> of useful things that we can do with the <code class="docutils literal notranslate"><span class="pre">my.anova</span></code> variable. So let’s assume that it’s this last command that I used to specify the ANOVA that I’m trying to run, and as a consequence I have this <code class="docutils literal notranslate"><span class="pre">my.anova</span></code> variable sitting in my workspace, waiting for me to do something with it…</p>
</div>
<div class="section" id="understanding-what-the-aov-function-produces-aovobjects">
<h3><span class="section-number">4.3.2. </span>Understanding what the <code class="docutils literal notranslate"><span class="pre">aov()</span></code> function produces{#aovobjects}<a class="headerlink" href="#understanding-what-the-aov-function-produces-aovobjects" title="Permalink to this headline">¶</a></h3>
<div class="highlight-{r notranslate"><div class="highlight"><pre><span></span>my.anova &lt;- aov( mood.gain ~ drug, clin.trial ) 
</pre></div>
</div>
<p>Now that we’ve seen how to use the <code class="docutils literal notranslate"><span class="pre">aov()</span></code> function to create <code class="docutils literal notranslate"><span class="pre">my.anova</span></code> we’d better have a look at what this variable actually is. The first thing to do is to check to see what class of variable we’ve created, since it’s  kind of interesting in this case. When we do that…</p>
<p>… we discover that <code class="docutils literal notranslate"><span class="pre">my.anova</span></code> actually has <em>two</em> classes! The first class tells us that it’s an <code class="docutils literal notranslate"><span class="pre">aov</span></code> (analysis of variance) object, but the second tells us that it’s <em>also</em> an <code class="docutils literal notranslate"><span class="pre">lm</span></code> (linear model) object. Later on, we’ll see that this reflects a pretty deep statistical relationship between ANOVA and regression (Chapter &#64;ref(regression) and it means that any function that exists in R for dealing with regressions can also be applied to <code class="docutils literal notranslate"><span class="pre">aov</span></code> objects, which is neat; but I’m getting ahead of myself. For now, I want to note that what we’ve created is an <code class="docutils literal notranslate"><span class="pre">aov</span></code> object, and to also make the point that <code class="docutils literal notranslate"><span class="pre">aov</span></code> objects are actually rather complicated beasts. I <em>won’t</em> be trying to explain everything about them, since it’s way beyond the scope of an introductory statistics subject, but to give you a tiny hint of some of the stuff that R stores inside an <code class="docutils literal notranslate"><span class="pre">aov</span></code> object, let’s ask it to print out the <code class="docutils literal notranslate"><span class="pre">names()</span></code> of all the stored quantities…</p>
<p>As we go through the rest of the book, I hope that a few of these will become a little more obvious to you, but right now that’s going to look pretty damned opaque. That’s okay. You don’t need to know any of the details about it right now, and most of it you don’t need at all… what you <em>do</em> need to understand is that the <code class="docutils literal notranslate"><span class="pre">aov()</span></code> function does a lot of calculations for you, not just the basic ones that I outlined in the previous sections. What this means is that it’s generally a good idea to create a variable like <code class="docutils literal notranslate"><span class="pre">my.anova</span></code> that stores the output of the <code class="docutils literal notranslate"><span class="pre">aov()</span></code> function… because later on, you can use <code class="docutils literal notranslate"><span class="pre">my.anova</span></code> as an input to lots of other functions:  those other functions can pull out bits and pieces from the <code class="docutils literal notranslate"><span class="pre">aov</span></code> object, and calculate various other things that you might need.</p>
<p>Right then. The simplest thing you can do with an <code class="docutils literal notranslate"><span class="pre">aov</span></code> object is to <code class="docutils literal notranslate"><span class="pre">print()</span></code> it out. When we do that, it shows us a few of the key quantities of interest:</p>
<p>Specificially, it prints out a reminder of the command that you used when you called <code class="docutils literal notranslate"><span class="pre">aov()</span></code> in the first place, shows you the sums of squares values, the degrees of freedom, and a couple of other quantities that we’re not really interested in right now. Notice, however, that R doesn’t use the names “between-group” and “within-group”. Instead, it tries to assign more meaningful names: in our particular example, the <em>between groups</em> variance corresponds to the effect that the <code class="docutils literal notranslate"><span class="pre">drug</span></code> has on the outcome variable; and the <em>within groups</em> variance is corresponds to the “leftover” variability, so it calls that the <em>residuals</em>. If we compare these numbers to the numbers that I calculated by hand in Section &#64;ref(anovacalc), you can see that they’re identical… the between groups sums of squares is <span class="math notranslate nohighlight">\(\mbox{SS}_b = 3.45\)</span>, the within groups sums of squares is <span class="math notranslate nohighlight">\(\mbox{SS}_w = 1.39\)</span>, and the degrees of freedom are 2 and 15 repectively.</p>
</div>
<div class="section" id="running-the-hypothesis-tests-for-the-anova">
<h3><span class="section-number">4.3.3. </span>Running the hypothesis tests for the ANOVA<a class="headerlink" href="#running-the-hypothesis-tests-for-the-anova" title="Permalink to this headline">¶</a></h3>
<p>Okay, so we’ve verified that <code class="docutils literal notranslate"><span class="pre">my.anova</span></code> seems to be storing a bunch of the numbers that we’re looking for, but the <code class="docutils literal notranslate"><span class="pre">print()</span></code> function didn’t quite give us the output that we really wanted. Where’s the <span class="math notranslate nohighlight">\(F\)</span>-value? The <span class="math notranslate nohighlight">\(p\)</span>-value? These are the most important numbers in our hypothesis test, but the <code class="docutils literal notranslate"><span class="pre">print()</span></code> function doesn’t provide them. To get those numbers, we need to use a different function. Instead of asking R to <code class="docutils literal notranslate"><span class="pre">print()</span></code> out the <code class="docutils literal notranslate"><span class="pre">aov</span></code> object, we should have asked for a <code class="docutils literal notranslate"><span class="pre">summary()</span></code> of it.^[It’s worth noting that you can get the same result by using the command <code class="docutils literal notranslate"><span class="pre">anova(</span> <span class="pre">my.anova</span> <span class="pre">)</span></code>.] When we do that…</p>
<p>… we get all of the key numbers that we calculated earlier. We get the sums of squares, the degrees of freedom, the mean squares, the <span class="math notranslate nohighlight">\(F\)</span>-statistic, and the <span class="math notranslate nohighlight">\(p\)</span>-value itself. These are all identical to the numbers that we calculated ourselves when doing it the long and tedious way, and it’s even organised into the same kind of ANOVA table that I showed in Table &#64;ref(tab:anovatable), and then filled out by hand in Section &#64;ref(anovacalc). The only things that are even slightly different is that some of the row and column names are a bit different.</p>
</div>
</div>
<div class="section" id="effect-size">
<span id="etasquared"></span><h2><span class="section-number">4.4. </span>Effect size<a class="headerlink" href="#effect-size" title="Permalink to this headline">¶</a></h2>
<p>There’s a few different ways you could measure the effect size in an ANOVA, but the most commonly used measures are <span class="math notranslate nohighlight">\(\eta^2\)</span> (<strong><em>eta squared</em></strong>) and partial <span class="math notranslate nohighlight">\(\eta^2\)</span>. For a one way analysis of variance they’re identical to each other, so for the moment I’ll just explain <span class="math notranslate nohighlight">\(\eta^2\)</span>. The definition of <span class="math notranslate nohighlight">\(\eta^2\)</span> is actually really simple:
$<span class="math notranslate nohighlight">\(
\eta^2 = \frac{\mbox{SS}_b}{\mbox{SS}_{tot}}
\)</span><span class="math notranslate nohighlight">\(
That's all it is. So when I look at the ANOVA table above, I see that \)</span>\mbox{SS}<em>b = 3.45<span class="math notranslate nohighlight">\(  and \)</span>\mbox{SS}</em>{tot} = 3.45 + 1.39 = 4.84<span class="math notranslate nohighlight">\(. Thus we get an \)</span>\eta^2<span class="math notranslate nohighlight">\( value of 
\)</span><span class="math notranslate nohighlight">\(
\eta^2 = \frac{3.45}{4.84} = 0.71
\)</span><span class="math notranslate nohighlight">\(
The interpretation of \)</span>\eta^2<span class="math notranslate nohighlight">\( is equally straightforward: it refers to the proportion of the variability in the outcome variable (`mood.gain`) that can be explained in terms of the predictor (`drug`). A value of \)</span>\eta^2 = 0<span class="math notranslate nohighlight">\( means that there is no relationship at all between the two, whereas a value of \)</span>\eta^2 = 1<span class="math notranslate nohighlight">\( means that the relationship is perfect. Better yet, the \)</span>\eta^2<span class="math notranslate nohighlight">\( value is very closely related to a squared correlation (i.e., \)</span>r^2<span class="math notranslate nohighlight">\(). So, if you're trying to figure out whether a particular value of \)</span>\eta^2<span class="math notranslate nohighlight">\( is big or small, it's sometimes useful to remember that 
\)</span><span class="math notranslate nohighlight">\(
\eta= \sqrt{\frac{\mbox{SS}_b}{\mbox{SS}_{tot}}}
\)</span><span class="math notranslate nohighlight">\(
can be interpreted as if it referred to the *magnitude* of a Pearson correlation. So in our drugs example, the \)</span>\eta^2<span class="math notranslate nohighlight">\( value of .71 corresponds to an \)</span>\eta<span class="math notranslate nohighlight">\( value of \)</span>\sqrt{.71} = .84$. If we think about this as being equivalent to a correlation of about .84, we’d conclude that the relationship between <code class="docutils literal notranslate"><span class="pre">drug</span></code> and <code class="docutils literal notranslate"><span class="pre">mood.gain</span></code> is strong.</p>
<p>The core packages in R don’t include any functions for calculating <span class="math notranslate nohighlight">\(\eta^2\)</span>. However, it’s pretty straightforward to calculate it directly from the numbers in the ANOVA table. In fact, since I’ve already got the <code class="docutils literal notranslate"><span class="pre">SSw</span></code> and <code class="docutils literal notranslate"><span class="pre">SSb</span></code> variables lying around from my earlier calculations, I can do this:</p>
<p>However, since it can be tedious to do this the long way (especially when we start running more complicated ANOVAs, such as those in Chapter &#64;ref(anova2) I’ve included an <code class="docutils literal notranslate"><span class="pre">etaSquared()</span></code> function in the <code class="docutils literal notranslate"><span class="pre">lsr</span></code> package which will do it for you. For now, the only argument you need to care about is <code class="docutils literal notranslate"><span class="pre">x</span></code>, which should be the <code class="docutils literal notranslate"><span class="pre">aov</span></code> object corresponding to your ANOVA. When we do this, what we get as output is this:</p>
<p>The output here shows two different numbers. The first one corresponds to the <span class="math notranslate nohighlight">\(\eta^2\)</span> statistic, precisely as described above. The second one refers to “partial <span class="math notranslate nohighlight">\(\eta^2\)</span>”, which is a somewhat different measure of effect size that I’ll describe later. For the simple ANOVA that we’ve just run, they’re the same number. But this won’t always be true once we start running more complicated ANOVAs.^[A potentially important footnote – I wrote the <code class="docutils literal notranslate"><span class="pre">etaSquared()</span></code> function for the <code class="docutils literal notranslate"><span class="pre">lsr</span></code> package as a teaching exercise, but like all the other functions in the <code class="docutils literal notranslate"><span class="pre">lsr</span></code> package it hasn’t been exhaustively tested. As of this writing – <code class="docutils literal notranslate"><span class="pre">lsr</span></code> package version 0.5 – there is at least one known bug in the code. In some cases at least, it doesn’t work (and can give very silly answers) when you set the <code class="docutils literal notranslate"><span class="pre">weights</span></code> on the observations to something other than uniform. That doesn’t matter at all for this book, since those kinds of analyses are well beyond the scope, but I haven’t had a chance to revisit the package in a long time; it would probably be wise to be very cautious with the use of this function in any context other than very simple introductory analyses. Thanks to Emil Kirkegaard for finding the bug! (Oh, and while I’m here, there’s an interesting blog post by Daniel Lakens suggesting that eta-squared itself is perhaps not the best measure of effect size in real world data analysis: http://daniellakens.blogspot.com.au/2015/06/why-you-should-use-omega-squared.html]</p>
</div>
<div class="section" id="multiple-comparisons-and-post-hoc-tests">
<span id="posthoc"></span><h2><span class="section-number">4.5. </span>Multiple comparisons and post hoc tests<a class="headerlink" href="#multiple-comparisons-and-post-hoc-tests" title="Permalink to this headline">¶</a></h2>
<p>Any time you run an ANOVA with more than two groups, and you end up with a significant effect, the first thing you’ll probably want to ask is which groups are actually different from one another. In our drugs example, our null hypothesis was that all three drugs (placebo, Anxifree and Joyzepam) have the exact same effect on mood. But if you think about it, the null hypothesis is actually claiming <em>three</em> different things all at once here. Specifically, it claims that:</p>
<ul class="simple">
<li><p>Your competitor’s drug (Anxifree) is no better than a placebo (i.e., <span class="math notranslate nohighlight">\(\mu_A = \mu_P\)</span>)</p></li>
<li><p>Your drug (Joyzepam) is no better than a placebo (i.e., <span class="math notranslate nohighlight">\(\mu_J = \mu_P\)</span>)</p></li>
<li><p>Anxifree and Joyzepam are equally effective (i.e., <span class="math notranslate nohighlight">\(\mu_J = \mu_A\)</span>)</p></li>
</ul>
<p>If any one of those three claims is false, then the null hypothesis is also false. So, now that we’ve rejected our null hypothesis, we’re thinking that <em>at least</em> one of those things isn’t true. But which ones? All three of these propositions are of interest: you certainly want to know if your new drug Joyzepam is better than a placebo, and it would be nice to know how well it stacks up against an existing commercial alternative (i.e., Anxifree). It would even be useful to check the performance of Anxifree against the placebo: even if Anxifree has already been extensively tested against placebos by other researchers, it can still be very useful to check that your study is producing similar results to earlier work.</p>
<p>When we characterise the null hypothesis in terms of these three distinct propositions, it becomes clear that there are eight possible “states of the world” that we need to distinguish between:</p>
<div class="highlight-{r notranslate"><div class="highlight"><pre><span></span>knitr::kable(tibble::tribble(
             ~V1,                     ~V2,                     ~V3,                     ~V4,                 ~V5,

             &quot;1&quot;,           &quot;$\\checkmark$&quot;,           &quot;$\\checkmark$&quot;,           &quot;$\\checkmark$&quot;,              &quot;null&quot;,
             &quot;2&quot;,           &quot;$\\checkmark$&quot;,           &quot;$\\checkmark$&quot;,                      &quot;&quot;,       &quot;alternative&quot;,
             &quot;3&quot;,           &quot;$\\checkmark$&quot;,                      &quot;&quot;,           &quot;$\\checkmark$&quot;,       &quot;alternative&quot;,
             &quot;4&quot;,           &quot;$\\checkmark$&quot;,                      &quot;&quot;,                      &quot;&quot;,       &quot;alternative&quot;,
             &quot;5&quot;,                      &quot;&quot;,           &quot;$\\checkmark$&quot;,           &quot;$\\checkmark$&quot;,       &quot;alternative&quot;,
             &quot;6&quot;,                      &quot;&quot;,           &quot;$\\checkmark$&quot;,                      &quot;&quot;,       &quot;alternative&quot;,
             &quot;7&quot;,                      &quot;&quot;,                      &quot;&quot;,           &quot;$\\checkmark$&quot;,       &quot;alternative&quot;,
             &quot;8&quot;,                      &quot;&quot;,                      &quot;&quot;,                      &quot;&quot;,       &quot;alternative&quot;
  ), col.names = c(&quot;possibility:&quot;, &quot;is $\\mu_P = \\mu_A$?&quot;, &quot;is $\\mu_P = \\mu_J$?&quot;, &quot;is $\\mu_A = \\mu_J$?&quot;, &quot;which hypothesis?&quot;))
</pre></div>
</div>
<p>By rejecting the null hypothesis, we’ve decided that we <em>don’t</em> believe that #1 is the true state of the world. The next question to ask is, which of the other seven possibilities <em>do</em> we think is right? When faced with this situation, its usually helps to look at the data. For instance, if we look at the plots in Figure &#64;ref(fig:moodgain), it’s tempting to conclude that Joyzepam is better than the placebo and better than Anxifree, but there’s no real difference between Anxifree and the placebo. However, if we want to get a clearer answer about this, it might help to run some tests.</p>
<div class="section" id="running-pairwise-t-tests">
<h3><span class="section-number">4.5.1. </span>Running “pairwise” <span class="math notranslate nohighlight">\(t\)</span>-tests<a class="headerlink" href="#running-pairwise-t-tests" title="Permalink to this headline">¶</a></h3>
<p>How might we go about solving our problem? Given that we’ve got three separate pairs of means (placebo versus Anxifree, placebo versus Joyzepam, and Anxifree versus Joyzepam) to compare, what we could do is run three separate <span class="math notranslate nohighlight">\(t\)</span>-tests and see what happens. There’s a couple of ways that we could do this. One method would be to construct new variables corresponding the groups you want to compare (e.g., <code class="docutils literal notranslate"><span class="pre">anxifree</span></code>, <code class="docutils literal notranslate"><span class="pre">placebo</span></code> and <code class="docutils literal notranslate"><span class="pre">joyzepam</span></code>), and then run a <span class="math notranslate nohighlight">\(t\)</span>-test on these new variables:</p>
<div class="highlight-{r notranslate"><div class="highlight"><pre><span></span>t.test( anxifree, placebo, var.equal = TRUE )   # Student t-test

anxifree &lt;- with(clin.trial, mood.gain[drug == &quot;anxifree&quot;])  # mood change due to anxifree
placebo &lt;- with(clin.trial, mood.gain[drug == &quot;placebo&quot;])    # mood change due to placebo 
</pre></div>
</div>
<p>or, you could use the <code class="docutils literal notranslate"><span class="pre">subset</span></code> argument in the <code class="docutils literal notranslate"><span class="pre">t.test()</span></code> function to select only those observations corresponding to one of the two groups we’re interested in:</p>
<div class="highlight-{r notranslate"><div class="highlight"><pre><span></span>t.test( formula = mood.gain ~ drug, 
       data = clin.trial, 
       subset = drug %in% c(&quot;placebo&quot;,&quot;anxifree&quot;), 
       var.equal = TRUE 
)
</pre></div>
</div>
<p>See Chapter &#64;ref(datahandling) if you’ve forgotten how the <code class="docutils literal notranslate"><span class="pre">%in%</span></code> operator works. Regardless of which version we do, R will print out the results of the <span class="math notranslate nohighlight">\(t\)</span>-test, though I haven’t included that output here. If we go on to do this for all possible pairs of variables, we can look to see which (if any) pairs of groups are significantly different to each other. This “lots of <span class="math notranslate nohighlight">\(t\)</span>-tests idea” isn’t a bad strategy, though as we’ll see later on there are some problems with it. However, for the moment our bigger problem is that it’s a <em>pain</em> to have to type in such a long command over and over again: for instance, if your experiment has 10 groups, then you have to run 45 <span class="math notranslate nohighlight">\(t\)</span>-tests. That’s way too much typing.</p>
<p>To help keep the typing to a minimum, R provides a function called <code class="docutils literal notranslate"><span class="pre">pairwise.t.test()</span></code> that automatically runs all of the <span class="math notranslate nohighlight">\(t\)</span>-tests for you. There are three arguments that you need to specify, the outcome variable <code class="docutils literal notranslate"><span class="pre">x</span></code>, the group variable <code class="docutils literal notranslate"><span class="pre">g</span></code>, and the <code class="docutils literal notranslate"><span class="pre">p.adjust.method</span></code> argument, which “adjusts” the <span class="math notranslate nohighlight">\(p\)</span>-value in one way or another. I’ll explain <span class="math notranslate nohighlight">\(p\)</span>-value adjustment in a moment, but for now we can just set <code class="docutils literal notranslate"><span class="pre">p.adjust.method</span> <span class="pre">=</span> <span class="pre">&quot;none&quot;</span></code> since we’re not doing any adjustments. For our example, here’s what we do:</p>
<p>One thing that bugs me slightly about the <code class="docutils literal notranslate"><span class="pre">pairwise.t.test()</span></code> function is that you can’t just give it an <code class="docutils literal notranslate"><span class="pre">aov</span></code> object, and have it produce this output. After all, I went to all that trouble earlier of getting R to create the <code class="docutils literal notranslate"><span class="pre">my.anova</span></code> variable and – as we saw in Section &#64;ref(aovobjects) – R has actually stored enough information inside it that I should just be able to get it to run all the pairwise tests using <code class="docutils literal notranslate"><span class="pre">my.anova</span></code> as an input. To that end, I’ve included a <code class="docutils literal notranslate"><span class="pre">posthocPairwiseT()</span></code> function in the <code class="docutils literal notranslate"><span class="pre">lsr</span></code> package that lets you do this. The idea behind this function is that you can just input the <code class="docutils literal notranslate"><span class="pre">aov</span></code> object itself,^[I should point out that there are other functions in R for running multiple comparisons, and at least one of them works this way: the <code class="docutils literal notranslate"><span class="pre">TukeyHSD()</span></code> function takes an <code class="docutils literal notranslate"><span class="pre">aov</span></code> object as its input, and outputs Tukey’s “honestly significant difference” tests. I talk about Tukey’s HSD in Chapter &#64;ref(anova2).] and then get the pairwise tests as an output. As of the current writing, <code class="docutils literal notranslate"><span class="pre">posthocPairwiseT()</span></code> is actually just a simple way of calling <code class="docutils literal notranslate"><span class="pre">pairwise.t.test()</span></code> function, but you should be aware that I intend to make some changes to it later on. Here’s an example:</p>
<p>In later versions, I plan to add more functionality (e.g., adjusted  confidence intervals), but for now I think it’s at least kind of useful. To see why, let’s suppose you’ve run your ANOVA and stored the results in <code class="docutils literal notranslate"><span class="pre">my.anova</span></code>, and you’re happy using the Holm correction (the default method in <code class="docutils literal notranslate"><span class="pre">pairwise.t.test()</span></code>, which I’ll explain this in a moment). In that case, all you have to do is type this:</p>
<div class="highlight-{r notranslate"><div class="highlight"><pre><span></span>posthocPairwiseT( my.anova )
</pre></div>
</div>
<p>and R will output the test results. Much more convenient, I think.</p>
</div>
<div class="section" id="corrections-for-multiple-testing">
<h3><span class="section-number">4.5.2. </span>Corrections for multiple testing<a class="headerlink" href="#corrections-for-multiple-testing" title="Permalink to this headline">¶</a></h3>
<p>In the previous section I hinted that there’s a problem with just running lots and lots of <span class="math notranslate nohighlight">\(t\)</span>-tests. The concern is that when running these analyses, what we’re doing is going on a “fishing expedition”: we’re running lots and lots of tests without much theoretical guidance, in the hope that some of them come up significant. This kind of theory-free search for group differences is referred to as <strong><em>post hoc analysis</em></strong> (“post hoc” being Latin for “after this”).^[If you <em>do</em> have some theoretical basis for wanting to investigate some comparisons but not others, it’s a different story. In those circumstances you’re not really running “post hoc” analyses at all: you’re making “planned comparisons”. I do talk about this situation later in the book (Section &#64;ref(plannedcomparisons)), but for now I want to keep things simple.]</p>
<p>It’s okay to run post hoc analyses, but a lot of care is required. For instance, the analysis that I ran in the previous section is actually pretty dangerous: each <em>individual</em> <span class="math notranslate nohighlight">\(t\)</span>-test is designed to have a 5% Type I error rate (i.e., <span class="math notranslate nohighlight">\(\alpha = .05\)</span>), and I ran three of these tests. Imagine what would have happened if my ANOVA involved 10 different groups, and I had decided to run 45 “post hoc” <span class="math notranslate nohighlight">\(t\)</span>-tests to try to find out which ones were significantly different from each other, you’d expect 2 or 3 of them to come up significant <em>by chance alone</em>. As we saw in Chapter &#64;ref(hypothesistesting), the central organising principle behind null hypothesis testing is that we seek to control our Type I error rate, but now that I’m running lots of <span class="math notranslate nohighlight">\(t\)</span>-tests at once, in order to determine the source of my ANOVA results, my actual Type I error rate across this whole <em>family</em> of tests has gotten completely out of control.</p>
<p>The usual solution to this problem is to introduce an adjustment to the <span class="math notranslate nohighlight">\(p\)</span>-value, which aims to control the total error rate across the family of tests [see &#64;Shaffer1995]. An adjustment of this form, which is usually (but not always) applied because one is doing post hoc analysis, is often referred to as a <strong><em>correction for multiple comparisons</em></strong>, though it is sometimes referred to as “simultaneous inference”. In any case, there are quite a few different ways of doing this adjustment. I’ll discuss a few of them in this section and in Section &#64;ref(posthoc2), but you should be aware that there are many other methods out there [see, e.g., &#64;Hsu1996].</p>
</div>
<div class="section" id="bonferroni-corrections">
<h3><span class="section-number">4.5.3. </span>Bonferroni corrections<a class="headerlink" href="#bonferroni-corrections" title="Permalink to this headline">¶</a></h3>
<p>The simplest of these adjustments is called the <strong><em>Bonferroni correction</em></strong> [&#64;Dunn1961], and it’s very very simple indeed. Suppose that my post hoc analysis consists of <span class="math notranslate nohighlight">\(m\)</span> separate tests, and I want to ensure that the total probability of making <em>any</em> Type I errors at all is at most <span class="math notranslate nohighlight">\(\alpha\)</span>.^[It’s worth noting in passing that not all adjustment methods try to do this. What I’ve described here is an approach for controlling “family wise Type I error rate”. However, there are other post hoc tests seek to control the “false discovery rate”, which is a somewhat different thing.] If so, then the Bonferroni correction just says “multiply all your raw <span class="math notranslate nohighlight">\(p\)</span>-values by <span class="math notranslate nohighlight">\(m\)</span>”. If we let <span class="math notranslate nohighlight">\(p\)</span> denote the original <span class="math notranslate nohighlight">\(p\)</span>-value, and let <span class="math notranslate nohighlight">\(p^\prime_j\)</span> be the corrected value, then the Bonferroni correction tells that:
$<span class="math notranslate nohighlight">\(
p^\prime = m \times p
\)</span><span class="math notranslate nohighlight">\(
And therefore, if you're using the Bonferroni correction, you would reject the null hypothesis if \)</span>p^\prime &lt; \alpha<span class="math notranslate nohighlight">\(. The logic behind this correction is very straightforward. We're doing \)</span>m<span class="math notranslate nohighlight">\( different tests; so if we arrange it so that each test has a Type I error rate of at most \)</span>\alpha / m<span class="math notranslate nohighlight">\(, then the *total* Type I error rate across these tests cannot be larger than \)</span>\alpha$. That’s pretty simple, so much so that in the original paper, the author writes:</p>
<blockquote>
<div><p>The method given here is so simple and so general that I am sure it must have been used before this. I do not find it, however, so can only conclude that perhaps its very simplicity has kept statisticians from realizing that it is a very good method in some situations [pp 52-53 &#64;Dunn1961]</p>
</div></blockquote>
<p>To use the Bonferroni correction in R, you can use the <code class="docutils literal notranslate"><span class="pre">pairwise.t.test()</span></code> function,^[There’s also a function called <code class="docutils literal notranslate"><span class="pre">p.adjust()</span></code> in which you can input a vector of raw <span class="math notranslate nohighlight">\(p\)</span>-values, and it will output a vector of adjusted <span class="math notranslate nohighlight">\(p\)</span>-values. This can be handy sometimes. I should also note that more advanced users may wish to consider using some of the tools provided by the <code class="docutils literal notranslate"><span class="pre">multcomp</span></code> package.] making sure that you set <code class="docutils literal notranslate"><span class="pre">p.adjust.method</span> <span class="pre">=</span> <span class="pre">&quot;bonferroni&quot;</span></code>. Alternatively, since the whole reason why we’re doing these pairwise tests in the first place is because we have an ANOVA that we’re trying to understand, it’s probably more convenient to use the <code class="docutils literal notranslate"><span class="pre">posthocPairwiseT()</span></code> function in the <code class="docutils literal notranslate"><span class="pre">lsr</span></code> package, since we can use <code class="docutils literal notranslate"><span class="pre">my.anova</span></code> as the input:</p>
<p>If we compare these three <span class="math notranslate nohighlight">\(p\)</span>-values to those that we saw in the previous section when we made no adjustment at all, it is clear that the only thing that R has done is multiply them by 3.</p>
</div>
<div class="section" id="holm-corrections">
<h3><span class="section-number">4.5.4. </span>Holm corrections<a class="headerlink" href="#holm-corrections" title="Permalink to this headline">¶</a></h3>
<p>Although the Bonferroni correction is the simplest adjustment out there, it’s not usually the best one to use. One method that is often used instead is the <strong><em>Holm correction</em></strong> [&#64;Holm1979]. The idea behind the Holm correction is to pretend that you’re doing the tests sequentially; starting with the smallest (raw) <span class="math notranslate nohighlight">\(p\)</span>-value and moving onto the largest one. For the <span class="math notranslate nohighlight">\(j\)</span>-th largest of the <span class="math notranslate nohighlight">\(p\)</span>-values, the adjustment is <em>either</em>
$<span class="math notranslate nohighlight">\(
p^\prime_j = j \times p_j 
\)</span><span class="math notranslate nohighlight">\(
(i.e., the biggest \)</span>p<span class="math notranslate nohighlight">\(-value remains unchanged, the second biggest \)</span>p<span class="math notranslate nohighlight">\(-value is doubled, the third biggest \)</span>p<span class="math notranslate nohighlight">\(-value is tripled, and so on), *or*
\)</span><span class="math notranslate nohighlight">\(
p^\prime_j = p^\prime_{j+1}
\)</span><span class="math notranslate nohighlight">\(
whichever one is *larger*. This might sound a little confusing, so let's go through it a little more slowly. Here's what the Holm correction does. First, you sort all of your \)</span>p<span class="math notranslate nohighlight">\(-values in order, from smallest to largest. For the smallest \)</span>p<span class="math notranslate nohighlight">\(-value all you do is multiply it by \)</span>m<span class="math notranslate nohighlight">\(, and you're done. However, for all the other ones it's a two-stage process. For instance, when you move to the second smallest \)</span>p<span class="math notranslate nohighlight">\( value, you first multiply it by \)</span>m-1<span class="math notranslate nohighlight">\(. If this produces a number that is bigger than the adjusted \)</span>p<span class="math notranslate nohighlight">\(-value that you got last time, then you keep it. But if it's smaller than the last one, then you copy the last \)</span>p<span class="math notranslate nohighlight">\(-value. To illustrate how this works, consider the table below, which shows the calculations of a Holm correction for a collection of five \)</span>p$-values:</p>
<div class="highlight-{r notranslate"><div class="highlight"><pre><span></span>knitr::kable(tibble::tribble(
        ~V1,        ~V2,             ~V3,        ~V4,

     &quot;.001&quot;,        &quot;5&quot;,          &quot;.005&quot;,     &quot;.005&quot;,
     &quot;.005&quot;,        &quot;4&quot;,          &quot;.020&quot;,     &quot;.020&quot;,
     &quot;.019&quot;,        &quot;3&quot;,          &quot;.057&quot;,     &quot;.057&quot;,
     &quot;.022&quot;,        &quot;2&quot;,          &quot;.044&quot;,     &quot;.057&quot;,
     &quot;.103&quot;,        &quot;1&quot;,          &quot;.103&quot;,     &quot;.103&quot;
  ), col.names = c(&quot;raw $p$&quot;, &quot;rank $j$&quot;, &quot;$p \\times j$&quot;, &quot;Holm $p$&quot;))
</pre></div>
</div>
<p>Hopefully that makes things clear.</p>
<p>Although it’s a little harder to calculate, the Holm correction has some very nice properties: it’s more powerful than Bonferroni (i.e., it has a lower Type II error rate), but – counterintuitive as it might seem – it has the <em>same</em> Type I error rate. As a consequence, in practice there’s never any reason to use the simpler Bonferroni correction, since it is always outperformed by the slightly more elaborate Holm correction. Because of this, the Holm correction is the default one used by <code class="docutils literal notranslate"><span class="pre">pairwise.t.test()</span></code> and <code class="docutils literal notranslate"><span class="pre">posthocPairwiseT()</span></code>. To run the Holm correction in R, you could specify <code class="docutils literal notranslate"><span class="pre">p.adjust.method</span> <span class="pre">=</span> <span class="pre">&quot;Holm&quot;</span></code> if you wanted to, but since it’s the default you can just to do this:</p>
<p>As you can see, the biggest <span class="math notranslate nohighlight">\(p\)</span>-value (corresponding to the comparison between Anxifree and the placebo) is unaltered: at a value of <span class="math notranslate nohighlight">\(.15\)</span>, it is exactly the same as the value we got originally when we applied no correction at all. In contrast, the smallest <span class="math notranslate nohighlight">\(p\)</span>-value (Joyzepam versus placebo) has been multiplied by three.</p>
</div>
<div class="section" id="writing-up-the-post-hoc-test">
<h3><span class="section-number">4.5.5. </span>Writing up the post hoc test<a class="headerlink" href="#writing-up-the-post-hoc-test" title="Permalink to this headline">¶</a></h3>
<p>Finally, having run the post hoc analysis to determine which groups are significantly different to one another, you might write up the result like this:</p>
<blockquote>
<div><p>Post hoc tests (using the Holm correction to adjust <span class="math notranslate nohighlight">\(p\)</span>) indicated that Joyzepam produced a significantly larger mood change than both Anxifree (<span class="math notranslate nohighlight">\(p = .001\)</span>) and the placebo (<span class="math notranslate nohighlight">\(p = 9.1 \times 10^{-5}\)</span>). We found no evidence that Anxifree performed better than the placebo (<span class="math notranslate nohighlight">\(p = .15\)</span>).</p>
</div></blockquote>
<p>Or, if you don’t like the idea of reporting exact <span class="math notranslate nohighlight">\(p\)</span>-values, then you’d change those numbers to <span class="math notranslate nohighlight">\(p&lt;.01\)</span>, <span class="math notranslate nohighlight">\(p&lt;.001\)</span> and <span class="math notranslate nohighlight">\(p &gt; .05\)</span> respectively. Either way, the key thing is that you indicate that you used Holm’s correction to adjust the <span class="math notranslate nohighlight">\(p\)</span>-values. And of course, I’m assuming that elsewhere in the write up you’ve included the relevant descriptive statistics (i.e., the group means and standard deviations), since these <span class="math notranslate nohighlight">\(p\)</span>-values on their own aren’t terribly informative.</p>
</div>
</div>
<div class="section" id="assumptions-of-one-way-anova">
<span id="anovaassumptions"></span><h2><span class="section-number">4.6. </span>Assumptions of one-way ANOVA<a class="headerlink" href="#assumptions-of-one-way-anova" title="Permalink to this headline">¶</a></h2>
<p>Like any statistical test, analysis of variance relies on some assumptions about the data. There are three key assumptions that you need to be aware of: <em>normality</em>, <em>homogeneity of variance</em> and <em>independence</em>. If you remember back to Section &#64;ref(anovamodel) – which I hope you at least skimmed even if you didn’t read the whole thing – I described the statistical models underpinning ANOVA, which I wrote down like this:
$<span class="math notranslate nohighlight">\(
\begin{array}{lrcl}
H_0: &amp; Y_{ik} &amp;=&amp; \mu + \epsilon_{ik} \\
H_1: &amp; Y_{ik} &amp;=&amp; \mu_k + \epsilon_{ik} 
\end{array}
\)</span><span class="math notranslate nohighlight">\(
In these equations \)</span>\mu<span class="math notranslate nohighlight">\( refers to a single, grand population mean which is the same for all groups, and \)</span>\mu_k<span class="math notranslate nohighlight">\( is the population mean for the \)</span>k<span class="math notranslate nohighlight">\(-th group. Up to this point we've been mostly interested in whether our data are best described in terms of a single grand mean (the null hypothesis) or in terms of different group-specific means (the alternative hypothesis). This makes sense, of course: that's actually the important research question! However, all of our testing procedures have -- implicitly -- relied on a specific assumption about the residuals, \)</span>\epsilon_{ik}<span class="math notranslate nohighlight">\(, namely that
\)</span><span class="math notranslate nohighlight">\(
\epsilon_{ik} \sim \mbox{Normal}(0, \sigma^2)
\)</span><span class="math notranslate nohighlight">\(
None of the maths works properly without this bit. Or, to be precise, you can still do all the calculations, and you'll end up with an \)</span>F<span class="math notranslate nohighlight">\(-statistic, but you have no guarantee that this \)</span>F<span class="math notranslate nohighlight">\(-statistic actually measures what you think it's measuring, and so any conclusions that you might draw on the basis of the \)</span>F$ test might be wrong.</p>
<p>So, how do we check whether this assumption about the residuals is accurate? Well, as I indicated above, there are three distinct claims buried in this one statement, and we’ll consider them separately.</p>
<ul class="simple">
<li><p><strong><em>Normality</em></strong>. The residuals are assumed to be normally distributed. As we saw in Section &#64;ref(shapiro), we can assess this by looking at QQ plots or running a Shapiro-Wilk test. I’ll talk about this in an ANOVA context in Section &#64;ref(anovanormality).</p></li>
<li><p><strong><em>Homogeneity of variance</em></strong>. Notice that we’ve only got the one value for the population standard deviation (i.e., <span class="math notranslate nohighlight">\(\sigma\)</span>), rather than allowing each group to have it’s own value (i.e., <span class="math notranslate nohighlight">\(\sigma_k\)</span>). This is referred to as the homogeneity of variance (sometimes called homoscedasticity) assumption. ANOVA assumes that the population standard deviation is the same for all groups. We’ll talk about this extensively in Section &#64;ref(levene).</p></li>
<li><p><strong><em>Independence</em></strong>. The independence assumption is a little trickier. What it basically means is that, knowing one residual tells you nothing about any other residual. All of the <span class="math notranslate nohighlight">\(\epsilon_{ik}\)</span> values are assumed to have been generated without any “regard for” or “relationship to” any of the other ones. There’s not an obvious or simple way to test for this, but there are some situations that are clear violations of this: for instance, if you have a repeated-measures design, where each participant in your study appears in more than one condition, then independence doesn’t hold; there’s a special relationship between some observations… namely those that correspond to the same person! When that happens, you need to use something like repeated measures ANOVA. I don’t currently talk about repeated measures ANOVA in this book, but it will be included in later versions.</p></li>
</ul>
<div class="section" id="how-robust-is-anova">
<h3><span class="section-number">4.6.1. </span>How robust is ANOVA?<a class="headerlink" href="#how-robust-is-anova" title="Permalink to this headline">¶</a></h3>
<p>One question that people often want to know the answer to is the extent to which you can trust the results of an ANOVA if the assumptions are violated. Or, to use the technical language, how <strong><em>robust</em></strong> is ANOVA to violations of the assumptions. Due to deadline constraints I don’t have the time to discuss this topic. This is a topic I’ll cover in some detail in a later version of the book.</p>
</div>
</div>
<div class="section" id="checking-the-homogeneity-of-variance-assumption">
<span id="levene"></span><h2><span class="section-number">4.7. </span>Checking the homogeneity of variance assumption<a class="headerlink" href="#checking-the-homogeneity-of-variance-assumption" title="Permalink to this headline">¶</a></h2>
<p>There’s more than one way to skin a cat, as the saying goes, and more than one way to test the homogeneity of variance assumption, too (though for some reason no-one made a saying out of that). The most commonly used test for this that I’ve seen in the literature is the <strong><em>Levene test</em></strong> [&#64;Levene1960], and the closely related <strong><em>Brown-Forsythe test</em></strong> [&#64;BrownForsythe1974], both of which I’ll describe here. Alternatively, you could use the Bartlett test, which is implemented in R via the <code class="docutils literal notranslate"><span class="pre">bartlett.test()</span></code> function, but I’ll leave it as an exercise for the reader to go check that one out if you’re interested.</p>
<p>Levene’s test is shockingly simple. Suppose we have our outcome variable <span class="math notranslate nohighlight">\(Y_{ik}\)</span>. All we do is define a new variable, which I’ll call <span class="math notranslate nohighlight">\(Z_{ik}\)</span>, corresponding to the absolute deviation from the group mean:
$<span class="math notranslate nohighlight">\(
Z_{ik} = \left| Y_{ik} - \bar{Y}_k \right|
\)</span><span class="math notranslate nohighlight">\(
Okay, what good does this do us? Well, let's take a moment to think about what \)</span>Z_{ik}<span class="math notranslate nohighlight">\( actually is, and what we're trying to test. The value of \)</span>Z_{ik}<span class="math notranslate nohighlight">\( is a measure of how the \)</span>i<span class="math notranslate nohighlight">\(-th observation in the \)</span>k<span class="math notranslate nohighlight">\(-th group deviates from its group mean. And our null hypothesis is that all groups have the same variance; that is, the same overall deviations from the group means! So, the null hypothesis in a Levene's test is that the population means of \)</span>Z<span class="math notranslate nohighlight">\( are identical for all groups. Hm. So what we need now is a statistical test of the null hypothesis that all group means are identical. Where have we seen that before? Oh right, that's what ANOVA is... and so all that the Levene's test does is run an ANOVA on the new variable \)</span>Z_{ik}$.</p>
<p>What about the Brown-Forsythe test? Does that do anything particularly different? Nope. The only change from the Levene’s test is that it constructs the transformed variable <span class="math notranslate nohighlight">\(Z\)</span> in a slightly different way, using deviations from the group <em>medians</em> rather than deviations from the group <em>means</em>. That is, for the Brown-Forsythe test,
$<span class="math notranslate nohighlight">\(
Z_{ik} = \left| Y_{ik} - \mbox{median}_k(Y) \right|
\)</span><span class="math notranslate nohighlight">\(
where \)</span>\mbox{median}<em>k(Y)<span class="math notranslate nohighlight">\( is the median for group \)</span>k<span class="math notranslate nohighlight">\(. Regardless of whether you're doing the standard Levene test or the Brown-Forsythe test, the test statistic -- which is sometimes denoted \)</span>F<span class="math notranslate nohighlight">\(, but sometimes written as \)</span>W<span class="math notranslate nohighlight">\( -- is  calculated in exactly the same way that the \)</span>F<span class="math notranslate nohighlight">\(-statistic for the regular ANOVA is calculated, just using a \)</span>Z</em>{ik}<span class="math notranslate nohighlight">\( rather than \)</span>Y_{ik}$. With that in mind, let’s just move on and look at how to run the test in R.</p>
<div class="section" id="running-the-levene-s-test-in-r">
<h3><span class="section-number">4.7.1. </span>Running the Levene’s test in R<a class="headerlink" href="#running-the-levene-s-test-in-r" title="Permalink to this headline">¶</a></h3>
<p>Okay, so how do we run the Levene test? Obviously, since the Levene test is just an ANOVA, it would be easy enough to manually create the transformed variable <span class="math notranslate nohighlight">\(Z_{ik}\)</span> and then use the <code class="docutils literal notranslate"><span class="pre">aov()</span></code> function to run an ANOVA on that. However, that’s the tedious way to do it. A better way to do run your Levene’s test is to use the <code class="docutils literal notranslate"><span class="pre">leveneTest()</span></code> function, which is in the <code class="docutils literal notranslate"><span class="pre">car</span></code> package.  As usual, we first load the package</p>
<p>and now that we have, we can run our Levene test. The main argument that you need to specify is <code class="docutils literal notranslate"><span class="pre">y</span></code>, but you can do this in lots of different ways. Probably the simplest way to do it is actually input the original <code class="docutils literal notranslate"><span class="pre">aov</span></code> object. Since I’ve got the <code class="docutils literal notranslate"><span class="pre">my.anova</span></code> variable stored from my original ANOVA, I can just do this:</p>
<p>If we look at the output, we see that the test is non-significant <span class="math notranslate nohighlight">\((F_{2,15} = 1.47, p = .26)\)</span>, so it looks like the homogeneity of variance assumption is fine. Remember, although R reports the test statistic as an <span class="math notranslate nohighlight">\(F\)</span>-value, it could equally be called <span class="math notranslate nohighlight">\(W\)</span>, in which case you’d just write <span class="math notranslate nohighlight">\(W_{2,15} = 1.47\)</span>. Also, note the part of the output that says <code class="docutils literal notranslate"><span class="pre">center</span> <span class="pre">=</span> <span class="pre">median</span></code>. That’s telling you that, by default, the <code class="docutils literal notranslate"><span class="pre">leveneTest()</span></code> function actually does the Brown-Forsythe test. If you want to use the mean instead, then you need to explicitly set the <code class="docutils literal notranslate"><span class="pre">center</span></code> argument, like this:</p>
<p>That being said, in most cases it’s probably best to stick to the default value, since the Brown-Forsythe test is a bit more robust than the original Levene test.</p>
</div>
<div class="section" id="additional-comments">
<h3><span class="section-number">4.7.2. </span>Additional comments<a class="headerlink" href="#additional-comments" title="Permalink to this headline">¶</a></h3>
<p>Two more quick comments before I move onto a different topic. Firstly, as mentioned above, there are other ways of calling the <code class="docutils literal notranslate"><span class="pre">leveneTest()</span></code> function. Although the vast majority of situations that call for a Levene test involve checking the assumptions of an ANOVA (in which case you probably have a variable like <code class="docutils literal notranslate"><span class="pre">my.anova</span></code> lying around), sometimes you might find yourself wanting to specify the variables directly. Two different ways that you can do this are shown below:</p>
<div class="highlight-{r notranslate"><div class="highlight"><pre><span></span>leveneTest(y = mood.gain ~ drug, data = clin.trial)   # y is a formula in this case
leveneTest(y = clin.trial$mood.gain, group = clin.trial$drug)   # y is the outcome  
</pre></div>
</div>
<p>Secondly, I did mention that it’s possible to run a Levene test just using the <code class="docutils literal notranslate"><span class="pre">aov()</span></code> function. I don’t want to waste a lot of space on this, but just in case some readers are interested in seeing how this is done, here’s the code that creates the new variables and runs an ANOVA. If you are interested, feel free to run this to verify that it produces the same answers as the Levene test (i.e., with <code class="docutils literal notranslate"><span class="pre">center</span> <span class="pre">=</span> <span class="pre">mean</span></code>):</p>
<p>That said, I don’t imagine that many people will care about this. Nevertheless, it’s nice to know that you could do it this way if you wanted to. And for those of you who do try it, I think it helps to demystify the test a little bit when you can see – with your own eyes – the way in which Levene’s test relates to ANOVA.</p>
</div>
</div>
<div class="section" id="removing-the-homogeneity-of-variance-assumption">
<span id="welchoneway"></span><h2><span class="section-number">4.8. </span>Removing the homogeneity of variance assumption<a class="headerlink" href="#removing-the-homogeneity-of-variance-assumption" title="Permalink to this headline">¶</a></h2>
<p>In our example, the homogeneity of variance assumption turned out to be a pretty safe one: the Levene test came back non-significant, so we probably don’t need to worry. However, in real life we aren’t always that lucky. How do we save our ANOVA when the homogeneity of variance assumption is violated? If you recall from our discussion of <span class="math notranslate nohighlight">\(t\)</span>-tests, we’ve seen this problem before. The Student <span class="math notranslate nohighlight">\(t\)</span>-test assumes equal variances, so the solution was to use the Welch <span class="math notranslate nohighlight">\(t\)</span>-test, which does not. In fact, &#64;Welch1951 also showed how we can solve this problem for ANOVA too (the <strong><em>Welch one-way test</em></strong>). It’s implemented in R using the <code class="docutils literal notranslate"><span class="pre">oneway.test()</span></code> function. The arguments that we’ll need for our example are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">formula</span></code>. This is the model formula, which (as usual) needs to specify the outcome variable on the left hand side and the grouping variable on the right hand side: i.e., something like <code class="docutils literal notranslate"><span class="pre">outcome</span> <span class="pre">~</span> <span class="pre">group</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>. Specifies the data frame containing the variables.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">var.equal</span></code>. If this is <code class="docutils literal notranslate"><span class="pre">FALSE</span></code> (the default) a Welch one-way test is run. If it is <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> then it just runs a regular ANOVA.</p></li>
</ul>
<p>The function also has a <code class="docutils literal notranslate"><span class="pre">subset</span></code> argument that lets you analyse only some of the observations and a <code class="docutils literal notranslate"><span class="pre">na.action</span></code> argument that tells it how to handle missing data, but these aren’t necessary for our purposes. So, to run the Welch one-way ANOVA for our example, we would do this:</p>
<p>To understand what’s happening here, let’s compare these numbers to what we got earlier in Section &#64;ref(introduceaov) when we ran our original ANOVA. To save you the trouble of flicking back, here are those numbers again, this time calculated by setting <code class="docutils literal notranslate"><span class="pre">var.equal</span> <span class="pre">=</span> <span class="pre">TRUE</span></code> for the <code class="docutils literal notranslate"><span class="pre">oneway.test()</span></code> function:</p>
<p>Okay, so originally our ANOVA gave us the result <span class="math notranslate nohighlight">\(F(2,15) = 18.6\)</span>, whereas the Welch one-way test gave us <span class="math notranslate nohighlight">\(F(2,9.49) = 26.32\)</span>. In other words, the Welch test has reduced the within-groups degrees of freedom from 15 to 9.49, and the <span class="math notranslate nohighlight">\(F\)</span>-value has increased from 18.6 to 26.32.</p>
</div>
<div class="section" id="checking-the-normality-assumption">
<span id="anovanormality"></span><h2><span class="section-number">4.9. </span>Checking the normality assumption<a class="headerlink" href="#checking-the-normality-assumption" title="Permalink to this headline">¶</a></h2>
<p>Testing the normality assumption is relatively straightforward. We covered most of what you need to know in Section &#64;ref(shapiro). The only thing we really need to know how to do is pull out the residuals (i.e., the <span class="math notranslate nohighlight">\(\epsilon_{ik}\)</span> values) so that we can draw our QQ plot and run our Shapiro-Wilk test. First, let’s extract the residuals. R provides a function called <code class="docutils literal notranslate"><span class="pre">residuals()</span></code> that will do this for us. If we pass our <code class="docutils literal notranslate"><span class="pre">my.anova</span></code> to this function, it will return the residuals.  So let’s do that:</p>
<p>We can print them out too, though it’s not exactly an edifying experience.  In fact, given that I’m on the verge of putting <em>myself</em> to sleep just typing this, it might be a good idea to skip that step. Instead, let’s draw some pictures and run ourselves a hypothesis test:</p>
<p>The histogram and QQ plot are both look pretty normal to me.^[Note that neither of these figures has been tidied up at all: if you want to create nicer looking graphs it’s always a good idea to use the tools from Chapter &#64;ref(graphics) to help you draw cleaner looking images.] This is supported by the results of our Shapiro-Wilk test (<span class="math notranslate nohighlight">\(W = .96\)</span>, <span class="math notranslate nohighlight">\(p = .61\)</span>) which finds no indication that normality is violated.</p>
</div>
<div class="section" id="removing-the-normality-assumption">
<span id="kruskalwallis"></span><h2><span class="section-number">4.10. </span>Removing the normality assumption<a class="headerlink" href="#removing-the-normality-assumption" title="Permalink to this headline">¶</a></h2>
<p>Now that we’ve seen how to check for normality, we are led naturally to ask what we can do to address violations of normality. In the context of a one-way ANOVA, the easiest solution is probably to switch to a non-parametric test (i.e., one that doesn’t rely on any particular assumption about the kind of distribution involved). We’ve seen non-parametric tests before, in Chapter &#64;ref(ttest): when you only have two groups, the Wilcoxon test provides the non-parametric alternative that you need. When you’ve got three or more groups, you can use the <strong><em>Kruskal-Wallis rank sum test</em></strong> [&#64;KruskalWallis1952]. So that’s the test we’ll talk about next.</p>
<div class="section" id="the-logic-behind-the-kruskal-wallis-test">
<h3><span class="section-number">4.10.1. </span>The logic behind the Kruskal-Wallis test<a class="headerlink" href="#the-logic-behind-the-kruskal-wallis-test" title="Permalink to this headline">¶</a></h3>
<p>The Kruskal-Wallis test is surprisingly similar to ANOVA, in some ways. In ANOVA, we started with <span class="math notranslate nohighlight">\(Y_{ik}\)</span>, the value of the outcome variable for the <span class="math notranslate nohighlight">\(i\)</span>th person in the <span class="math notranslate nohighlight">\(k\)</span>th group. For the Kruskal-Wallis test, what we’ll do is rank order all of these <span class="math notranslate nohighlight">\(Y_{ik}\)</span> values, and conduct our analysis on the ranked data. So let’s let <span class="math notranslate nohighlight">\(R_{ik}\)</span> refer to the ranking given to the <span class="math notranslate nohighlight">\(i\)</span>th member of the <span class="math notranslate nohighlight">\(k\)</span>th group. Now, let’s calculate <span class="math notranslate nohighlight">\(\bar{R}_k\)</span>, the average rank given to observations in the <span class="math notranslate nohighlight">\(k\)</span>th group:
$<span class="math notranslate nohighlight">\(
\bar{R}_k = \frac{1}{N_K} \sum_{i} R_{ik}
\)</span><span class="math notranslate nohighlight">\(
and let's also calculate \)</span>\bar{R}<span class="math notranslate nohighlight">\(, the grand mean rank:
\)</span><span class="math notranslate nohighlight">\(
\bar{R} = \frac{1}{N} \sum_{i} \sum_{k} R_{ik}
\)</span><span class="math notranslate nohighlight">\(
Now that we've done this, we can calculate the squared deviations from the grand mean rank \)</span>\bar{R}<span class="math notranslate nohighlight">\(. When we do this for the individual scores -- i.e., if we calculate \)</span>(R_{ik} - \bar{R})^2<span class="math notranslate nohighlight">\( -- what we have is a &quot;nonparametric&quot; measure of how far the \)</span>ik<span class="math notranslate nohighlight">\(-th observation deviates from the grand mean rank. When we calculate the squared deviation of the group means from the grand means -- i.e., if we calculate \)</span>(\bar{R}<em>k  - \bar{R} )^2<span class="math notranslate nohighlight">\( -- then what we have is a nonparametric measure of how much the *group* deviates from the grand mean rank. With this in mind, let's follow the same logic that we did with ANOVA, and define our *ranked* sums of squares measures in much the same way that we did earlier. First, we have our &quot;total ranked sums of squares&quot;:
\)</span><span class="math notranslate nohighlight">\(
\mbox{RSS}_{tot} = \sum_k \sum_i ( R_{ik} - \bar{R} )^2
\)</span><span class="math notranslate nohighlight">\(
and we can define the &quot;between groups ranked sums of squares&quot; like this:
\)</span><span class="math notranslate nohighlight">\(
\begin{array}{rcl}
\mbox{RSS}_{b} &amp;=&amp; \sum_k \sum_i ( \bar{R}_k  - \bar{R} )^2 \\
&amp;=&amp; \sum_k N_k ( \bar{R}_k  - \bar{R} )^2 
\end{array}
\)</span><span class="math notranslate nohighlight">\(
So, if the null hypothesis is true and there are no true group differences at all, you'd expect the between group rank sums \)</span>\mbox{RSS}</em>{b}<span class="math notranslate nohighlight">\( to be very small, much smaller than the total rank sums \)</span>\mbox{RSS}_{tot}<span class="math notranslate nohighlight">\(. Qualitatively this is very much the same as what we found when we went about constructing the ANOVA \)</span>F<span class="math notranslate nohighlight">\(-statistic; but for technical reasons the Kruskal-Wallis test statistic, usually denoted \)</span>K<span class="math notranslate nohighlight">\(, is constructed in a slightly different way: 
\)</span><span class="math notranslate nohighlight">\(
K = (N - 1) \times \frac{\mbox{RSS}_b}{\mbox{RSS}_{tot}}
\)</span><span class="math notranslate nohighlight">\(
and, if the null hypothesis is true, then the sampling distribution of \)</span>K<span class="math notranslate nohighlight">\( is *approximately* chi-square with \)</span>G-1<span class="math notranslate nohighlight">\( degrees of freedom (where \)</span>G<span class="math notranslate nohighlight">\( is the number of groups). The larger the value of \)</span>K<span class="math notranslate nohighlight">\(, the less consistent the data are with null hypothesis, so this is a one-sided test: we reject \)</span>H_0<span class="math notranslate nohighlight">\( when \)</span>K$ is sufficiently large.</p>
</div>
<div class="section" id="additional-details">
<h3><span class="section-number">4.10.2. </span>Additional details<a class="headerlink" href="#additional-details" title="Permalink to this headline">¶</a></h3>
<p>The description in the previous section illustrates the logic behind the Kruskal-Wallis test. At a conceptual level, this is the right way to think about how the test works. However, from a purely mathematical perspective it’s needlessly complicated. I won’t show you the derivation, but you can use a bit of algebraic jiggery-pokery^[A technical term.] to show that the equation for <span class="math notranslate nohighlight">\(K\)</span> can be rewritten as
$<span class="math notranslate nohighlight">\(
K = \frac{12}{N(N-1)} \sum_k N_k {\bar{R}_k}^2    -  3(N+1)
\)</span><span class="math notranslate nohighlight">\(
It's this last equation that you sometimes see given for \)</span>K<span class="math notranslate nohighlight">\(. This is way easier to calculate than the version I described in the previous section, it's just that it's totally meaningless to actual humans. It's probably best to think of \)</span>K$ the way I described it earlier… as an analogue of ANOVA based on ranks. But keep in mind that the test statistic that gets calculated ends up with a rather different look to it than the one we used for our original ANOVA.</p>
<p>But wait, there’s more! Dear lord, why is there always <em>more</em>? The story I’ve told so far is only actually true when there are no ties in the raw data. That is, if there are no two observations that have exactly the same value. If there <em>are</em> ties, then we have to introduce a correction factor to these calculations. At this point I’m assuming that even the most diligent reader has stopped caring (or at least formed the opinion that the tie-correction factor is something that doesn’t require their immediate attention). So I’ll very quickly tell you how it’s calculated, and omit the tedious details about <em>why</em> it’s done this way. Suppose we construct a frequency table for the raw data, and let <span class="math notranslate nohighlight">\(f_j\)</span> be the number of observations that have the <span class="math notranslate nohighlight">\(j\)</span>-th unique value. This might sound a bit abstract, so here’s the R code showing a concrete example:</p>
<p>Looking at this table, notice that the third entry in the frequency table has a value of <span class="math notranslate nohighlight">\(2\)</span>. Since this corresponds to a <code class="docutils literal notranslate"><span class="pre">mood.gain</span></code> of 0.3, this table is telling us that two people’s mood increased by 0.3. More to the point, note that we can say that <code class="docutils literal notranslate"><span class="pre">f[3]</span></code> has a value of <code class="docutils literal notranslate"><span class="pre">2</span></code>. Or, in the mathematical notation I introduced above, this is telling us that <span class="math notranslate nohighlight">\(f_3 = 2\)</span>. Yay. So, now that we know this, the tie correction factor (TCF) is:
$<span class="math notranslate nohighlight">\(
\mbox{TCF} = 1 - \frac{\sum_j {f_j}^3 - f_j}{N^3 - N} 
\)</span><span class="math notranslate nohighlight">\(
The tie-corrected value of the Kruskal-Wallis statistic obtained by dividing the value of \)</span>K$ by this quantity: it is this tie-corrected version that R calculates. And at long last, we’re actually finished with the theory of the Kruskal-Wallis test. I’m sure you’re all terribly relieved that I’ve cured you of the existential anxiety that naturally arises when you realise that you <em>don’t</em> know how to calculate the tie-correction factor for the Kruskal-Wallis test. Right?</p>
</div>
<div class="section" id="how-to-run-the-kruskal-wallis-test-in-r">
<h3><span class="section-number">4.10.3. </span>How to run the Kruskal-Wallis test in R<a class="headerlink" href="#how-to-run-the-kruskal-wallis-test-in-r" title="Permalink to this headline">¶</a></h3>
<p>Despite the horror that we’ve gone through in trying to understand what the Kruskal-Wallis test actually does, it turns out that running the test is pretty painless, since R has a function called <code class="docutils literal notranslate"><span class="pre">kruskal.test()</span></code>. The function is pretty flexible, and allows you to input your data in a few different ways. Most of the time you’ll have data like the <code class="docutils literal notranslate"><span class="pre">clin.trial</span></code> data set, in which you have your outcome variable <code class="docutils literal notranslate"><span class="pre">mood.gain</span></code>, and a grouping variable <code class="docutils literal notranslate"><span class="pre">drug</span></code>. If so, you can call the <code class="docutils literal notranslate"><span class="pre">kruskal.test()</span></code> function by specifying a formula, and a data frame:</p>
<p>A second way of using the <code class="docutils literal notranslate"><span class="pre">kruskal.test()</span></code> function, which you probably won’t have much reason to use, is to directly specify the outcome variable and the grouping variable as separate input arguments, <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">g</span></code>:</p>
<p>This isn’t very interesting, since it’s just plain easier to specify a formula. However, sometimes it can be useful to specify <code class="docutils literal notranslate"><span class="pre">x</span></code> as a list. What I mean is this. Suppose you actually had data as three separate variables, <code class="docutils literal notranslate"><span class="pre">placebo</span></code>, <code class="docutils literal notranslate"><span class="pre">anxifree</span></code> and <code class="docutils literal notranslate"><span class="pre">joyzepam</span></code>. If that’s the format that your data are in, then it’s convenient to know that you can bundle all three together as a list:</p>
<div class="highlight-{r notranslate"><div class="highlight"><pre><span></span>mood.gain &lt;- list( placebo, joyzepam, anxifree )
kruskal.test( x = mood.gain )
</pre></div>
</div>
<p>And again, this would give you exactly the same results as the command we tried originally.</p>
</div>
</div>
<div class="section" id="on-the-relationship-between-anova-and-the-student-t-test-anovaandt">
<h2><span class="section-number">4.11. </span>On the relationship between ANOVA and the Student <span class="math notranslate nohighlight">\(t\)</span> test{#anovaandt}<a class="headerlink" href="#on-the-relationship-between-anova-and-the-student-t-test-anovaandt" title="Permalink to this headline">¶</a></h2>
<p>There’s one last thing I want to point out before finishing. It’s something that a lot of people find kind of surprising, but it’s worth knowing about: an ANOVA with two groups is identical to the Student <span class="math notranslate nohighlight">\(t\)</span>-test. No, really. It’s not just that they are similar, but they are actually equivalent in every meaningful way. I won’t try to prove that this is always true, but I will show you a single concrete demonstration. Suppose that, instead of running an ANOVA on our <code class="docutils literal notranslate"><span class="pre">mood.gain</span> <span class="pre">~</span> <span class="pre">drug</span></code> model, let’s instead do it using <code class="docutils literal notranslate"><span class="pre">therapy</span></code> as the predictor. If we run this ANOVA, here’s what we get:</p>
<p>Overall, it looks like there’s no significant effect here at all but, as we’ll see in Chapter &#64;ref(anova2 this is actually a misleading  answer! In any case, it’s irrelevant to our current goals: our interest here is in the <span class="math notranslate nohighlight">\(F\)</span>-statistic, which is <span class="math notranslate nohighlight">\(F(1,16) = 1.71\)</span>, and the <span class="math notranslate nohighlight">\(p\)</span>-value, which is .21. Since we only have two groups, I didn’t actually need to resort to an ANOVA, I could have just decided to run a Student <span class="math notranslate nohighlight">\(t\)</span>-test. So let’s see what happens when I do that:</p>
<p>Curiously, the <span class="math notranslate nohighlight">\(p\)</span>-values are identical: once again we obtain a value of <span class="math notranslate nohighlight">\(p = .21\)</span>. But what about the test statistic? Having run a <span class="math notranslate nohighlight">\(t\)</span>-test instead of an ANOVA, we get a somewhat different answer, namely <span class="math notranslate nohighlight">\(t(16) = -1.3068\)</span>. However, there is a fairly straightforward relationship here. If we square the <span class="math notranslate nohighlight">\(t\)</span>-statistic</p>
<p>we get the <span class="math notranslate nohighlight">\(F\)</span>-statistic from before.</p>
</div>
<div class="section" id="summary">
<h2><span class="section-number">4.12. </span>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>There’s a fair bit covered in this chapter, but there’s still a lot missing. Most obviously, I haven’t yet discussed any analog of the paired samples <span class="math notranslate nohighlight">\(t\)</span>-test for more than two groups. There is a way of doing this, known as <em>repeated measures ANOVA</em>, which will appear in a later version of this book. I also haven’t discussed how to run an ANOVA when you are interested in more than one grouping variable, but that will be discussed in a lot of detail in Chapter &#64;ref(anova2). In terms of what we have discussed, the key topics were:</p>
<ul class="simple">
<li><p>The basic logic behind how ANOVA works (Section &#64;ref(anovaintro)) and how to run one in R (Section &#64;ref(introduceaov)).</p></li>
<li><p>How to compute an effect size for an ANOVA (Section &#64;ref(etasquared))</p></li>
<li><p>Post hoc analysis and corrections for multiple testing (Section &#64;ref(posthoc)).</p></li>
<li><p>The assumptions made by ANOVA (Section &#64;ref(anovaassumptions)).</p></li>
<li><p>How to check the homogeneity of variance assumption (Section &#64;ref(levene)) and what to do if it is violated (Section &#64;ref(welchoneway)).</p></li>
<li><p>How to check the normality assumption (Section &#64;ref(anovanormality) and what to do if it is violated (Section &#64;ref(kruskalwallis)).</p></li>
</ul>
<p>As with all of the chapters in this book, there are quite a few different sources that I’ve relied upon, but the one stand-out text that I’ve been most heavily influenced by is &#64;Sahai2000. It’s not a good book for beginners, but it’s an excellent book for more advanced readers who are interested in understanding the mathematics behind ANOVA.</p>
<hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="note1"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>When all groups have the same number of observations, the experimental design is said to be “balanced”. Balance isn’t such a big deal for one-way ANOVA, which is the topic of this chapter. It becomes more important when you start doing more complicated ANOVAs.</p>
</dd>
<dt class="label" id="note2"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>In a later versions I’m intending to expand on this. But because I’m writing in a rush, and am already over my deadlines, I’ll just briefly note that if you read ahead to Chapter &#64;ref(anova2) and look at how the “treatment effect” at level <span class="math notranslate nohighlight">\(k\)</span> of a factor is defined in terms of the <span class="math notranslate nohighlight">\(\alpha_k\)</span> values (see Section &#64;ref(interactions)), it turns out that <span class="math notranslate nohighlight">\(Q\)</span> refers to a weighted mean of the squared treatment effects, <span class="math notranslate nohighlight">\(Q=(\sum_{k=1}^G N_k\alpha_k^2)/(G-1)\)</span>.</p>
</dd>
<dt class="label" id="note3"><span class="brackets"><a class="fn-backref" href="#id4">3</a></span></dt>
<dd><p>Or, if we want to be sticklers for accuracy, <span class="math notranslate nohighlight">\(1 + \frac{2}{df_2 - 2}\)</span>.</p>
</dd>
<dt class="label" id="note4"><span class="brackets"><a class="fn-backref" href="#id5">4</a></span></dt>
<dd><p>Or, to be precise, party like “it’s 1899 and we’ve got no friends and nothing better to do with our time than do some calculations that wouldn’t have made any sense in 1899 because ANOVA didn’t exist until about the 1920s”.</p>
</dd>
</dl>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="05.02-ttest.html" title="previous page"><span class="section-number">2. </span>Comparing Two Means</a>
    <a class='right-next' id="next-link" href="05.04-regression.html" title="next page"><span class="section-number">5. </span>Linear regression</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Danielle Navarro and Ethan Weed<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>